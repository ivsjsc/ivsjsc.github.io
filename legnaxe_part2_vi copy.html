<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LEGNAXE: Part 2 - Heavenly, Human’s Heart</title>
    <meta name="description" content="LEGNAXE Phần 2: Heavenly, Human’s Heart - Khám phá hành trình của các thiên thần trên Trái Đất, những thử thách của lòng trắc ẩn và sự tự do.">
    <meta property="og:title" content="LEGNAXE Part 2: Heavenly, Human’s Heart">
    <meta property="og:description" content="Đọc truyện LEGNAXE Phần 2, theo chân Healiangel và Lucifer trong cuộc chiến định mệnh trên Trái Đất.">
    <meta property="og:image" content="https://placehold.co/1200x630/8B5CF6/FFFFFF?text=LEGNAXE+Part+2">
    <meta property="og:url" content="https://ivs.id.vn/legnaxe_part2_vi.html">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Truyện Dài">
    <meta property="article:author" content="Nguyen Minh Triet">

    <link rel="icon" href="https://placehold.co/32x32/8B5CF6/FFFFFF?text=L" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind config from the existing document, primarily for font and any custom animations if still needed.
        // Colors will largely be driven by direct Tailwind classes from the new template.
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    // Keeping existing color definitions in case they are used by classes not overridden by new template
                    colors: {
                        'primary': '#3b82f6',
                        'primary-dark': '#2563eb',
                        'secondary': '#10b981',
                        'purple-accent': '#8b5cf6',
                        'purple-700': '#7c3aed',
                        'warning': '#f59e0b',
                        'neutral-50': '#f9fafb',
                        'neutral-100': '#f3f4f6',
                        'neutral-200': '#e5e7eb',
                        'neutral-300': '#d1d5db',
                        'neutral-400': '#9ca3af',
                        'neutral-500': '#6b7280',
                        'neutral-600': '#4b5563',
                        'neutral-700': '#374151',
                        'neutral-800': '#1f2937', // Used by modal dark bg
                        'neutral-900': '#111827',
                        // gray colors from new template's direct usage
                        'gray-50': '#f9fafb',
                        'gray-100': '#f3f4f6',
                        'gray-200': '#e5e7eb',
                        'gray-300': '#d1d5db',
                        'gray-400': '#9ca3af',
                        'gray-500': '#6b7280',
                        'gray-600': '#4b5563',
                        'gray-700': '#374151',
                        'gray-800': '#1f2937', // Used by header dark bg
                        'gray-900': '#111827', // Used by body dark bg
                        'blue-200': '#bfdbfe',
                        'blue-300': '#93c5fd',
                        'blue-400': '#60a5fa', // For logo error text dark
                        'blue-600': '#2563eb', // For buttons and logo error text light
                        'blue-700': '#1d4ed8',
                        'red-400': '#f87171', // For close modal hover dark
                        'red-600': '#dc2626', // For close modal hover light
                    },
                    animation: {
                        // 'fade-in': 'fadeIn 0.5s ease-out', // Replaced by new template's CSS
                        'slide-up': 'slideUp 0.5s ease-out', // Kept from existing
                        'pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite', // Kept
                    },
                    keyframes: {
                        // fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, // Replaced
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        pulse: { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0.5' } },
                    },
                },
            },
            darkMode: 'class',
            // plugins: [require('@tailwindcss/typography')], // If using npm, otherwise ensure prose classes work
        }
    </script>

    <style>
        /* Custom CSS from the new template */
        .chapter {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            opacity: 0;
            transform: translateY(15px); /* Subtle upward movement */
            display: none; /* Ensure non-active chapters are not taking space */
        }
        .chapter.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }

        /* Style for the modal (adapted from new template) */
        #chapter-modal { /* This ID matches the modal element */
            transition: opacity 0.3s ease-in-out;
            /* display: none; is handled by opacity and pointer-events */
        }
        #chapter-modal .modal-content { /* This class matches the modal content div */
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        #chapter-modal.modal-active { /* Add this class via JS to show modal */
            opacity: 1 !important;
            pointer-events: auto;
        }
        #chapter-modal.modal-active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        /* Custom scrollbar for dark mode (from new template) */
        .dark body::-webkit-scrollbar {
            width: 10px;
        }
        .dark body::-webkit-scrollbar-track {
            background: #111827; /* Tailwind gray-900 */
        }
        .dark body::-webkit-scrollbar-thumb {
            background-color: #4b5563; /* Tailwind gray-600 */
            border-radius: 20px;
            border: 2px solid #111827; /* Match track */
        }
        .dark body::-webkit-scrollbar-thumb:hover {
            background-color: #6b7280; /* Tailwind gray-500 */
        }

        /* Custom scrollbar for modal list in dark mode (from new template) */
        .dark #chapter-modal .modal-content ul::-webkit-scrollbar {
            width: 8px;
        }
        .dark #chapter-modal .modal-content ul::-webkit-scrollbar-track {
            background: #1f2937; /* Tailwind gray-800 (modal bg) */
        }
        .dark #chapter-modal .modal-content ul::-webkit-scrollbar-thumb {
            background: #4b5563; /* Tailwind gray-600 */
            border-radius: 4px;
        }
        .dark #chapter-modal .modal-content ul::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* Tailwind gray-500 */
        }

        /* Ensure prose classes are applied if not using the Typography plugin via CDN/npm */
        .prose { @apply max-w-none; }
        .prose p { @apply mb-4 leading-relaxed; }
        .prose strong { @apply font-semibold; }
        .dark .dark\:prose-invert p { @apply text-gray-300; }
        .dark .dark\:prose-invert strong { @apply text-white; }
        .text-justify { text-align: justify; }

        /* Additional styling for h3 within chapters to match new template's style */
        .chapter h3 {
             @apply text-2xl sm:text-3xl font-semibold mb-6 mt-4 text-gray-800 dark:text-gray-100 border-b pb-3 border-gray-200 dark:border-gray-700;
             /* Overriding the general h3 style for chapter titles specifically */
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300 ease-in-out font-sans antialiased">
    <header id="navbar" class="bg-gray-50 dark:bg-gray-800 shadow-lg sticky top-0 z-50 transition-colors duration-300 ease-in-out">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-20">
            <div class="logo">
                <a href="index.html" aria-label="Trang chủ LEGNAXE">
                    <img src="https://placehold.co/120x48/1f2937/f3f4f6?text=Logo" alt="LEGNAXE Logo" class="h-10 sm:h-12 w-auto transition-all duration-300 ease-in-out hover:opacity-80"
                         onerror="this.style.display='none'; const newText = document.createElement('span'); newText.className='text-xl font-bold text-blue-600 dark:text-blue-400'; newText.textContent='LEGNAXE'; this.parentNode.appendChild(newText);">
                </a>
            </div>
            <nav class="flex items-center space-x-2 sm:space-x-4 md:space-x-6">
                <a href="index.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm sm:text-base font-medium transition-colors">Trang Chủ</a>
                <a href="readnovel.html" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 px-3 py-2 rounded-md text-sm sm:text-base font-medium transition-colors">Danh sách truyện</a>
                <button id="theme-toggle" aria-label="Chuyển đổi chế độ sáng tối" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 focus:outline-none p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-200 ease-in-out">
                    <i class="fas fa-moon text-xl"></i>
                </button>
            </nav>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-12">
        <h1 class="text-4xl sm:text-5xl font-bold text-center mb-2 text-gray-900 dark:text-white animate-slide-up">LEGNAXE</h1>
        <h2 class="text-2xl sm:text-3xl font-semibold text-center mb-10 text-blue-600 dark:text-blue-400 animate-slide-up">Part 2: Heavenly, Human’s Heart</h2>

        <div class="story-content-wrapper bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-xl shadow-xl transition-colors duration-300 ease-in-out">
            <img src="images\pages\novels\legnaxe2.png" alt="LEGNAXE Part 2 Banner" class="mb-8 rounded-lg shadow-md w-full max-h-[300px] sm:max-h-[400px] object-cover">

            <div class="chapter active" id="chapter-1">
                <h3>Chương 1: Lời Từ Biệt Trên Ngai Vàng</h3>
                <div class="prose prose-lg dark:prose-invert max-w-none">
                    <p>Hậu quả của sự kiện Tấm Màn vỡ (hay có lẽ, chính hành động hy sinh đầy nghịch lý của Healiangel để vá lại nó bằng một thực thể lai tạp) không chỉ là những vết sẹo chiến tranh hằn trên đôi cánh thiên thần hay sự im lặng nặng nề thay thế cho bản hòa ca vĩnh cửu. Nó là một sự rạn nứt sâu sắc hơn, một sự rò rỉ năng lượng hỗn loạn mà ngay cả ánh sáng thuần khiết nhất của Thiên Đàng cũng không thể hàn gắn hoàn toàn. Bầu trời thiên giới không còn xanh biếc vô tận, mà loang lổ những mảng tối kỳ lạ, nơi năng lượng hư không từ bên ngoài vẫn âm ỉ xâm nhập. Ánh sáng chung của Thiên Đàng, nguồn sống của mọi tạo vật nơi đây, đang suy yếu dần, nhịp đập của nó trở nên yếu ớt, bất định.</p>
                    <p>Trong Đại Điện Ánh Sáng, nơi từng là trung tâm quyền lực và vinh quang, giờ đây bao trùm bởi một bầu không khí tang tóc. Các thiên thần, từ những Seraphim rực lửa đến những Cherubim canh giữ, cả những người trung thành lẫn những kẻ sa ngã vừa được chứng kiến sự sụp đổ của thủ lĩnh Lucifer, đều tụ tập trong im lặng. Sự huy hoàng xưa kia chỉ còn là ký ức. Nỗi sợ hãi, thứ cảm xúc xa lạ với bản thể thiên thần, giờ đây hiện hữu rõ rệt trong từng ánh mắt, từng cái run rẩy của đôi cánh. Họ nhìn nhau, nhìn những vết nứt năng lượng ngày càng lan rộng trên những bức tường pha lê từng vững chắc như vĩnh cửu, nhìn ánh sáng chung đang lụi tàn như ngọn đèn trước gió. Một câu hỏi câm lặng, đầy thống khổ, vang lên trong tâm trí mỗi người: <em>Đấng Sáng Tạo ở đâu? Tại sao Ngài im lặng trước sự suy vong đang đến gần?</em></p>
                    <p>Ngay lúc đó, như đáp lại lời cầu nguyện câm lặng và tuyệt vọng ấy, Ngai Vàng ở trung tâm Đại Điện bất chợt bừng sáng. Nhưng thứ ánh sáng lần này không còn là hào quang chói lọi, uy nghiêm khiến mọi sinh vật phải phủ phục. Nó mang một vẻ dịu dàng khác thường, một màu vàng nhạt ấm áp nhưng nhuốm đầy vẻ trầm buồn, phảng phất sự mệt mỏi của hàng thiên niên kỷ quan sát và chờ đợi. Thiên Chúa hiện diện, không phải bằng quyền năng tuyệt đối nghiền nát mọi thứ, mà như một người Cha nhìn đàn con đang lạc lối sau khi tự tay phá hủy ngôi nhà của mình.</p>
                    <p>Giọng nói của Ngài vang lên, không phải tiếng sấm sét của mệnh lệnh, mà là một lời thì thầm bao la, trầm ấm, thấm đẫm cả vũ trụ. Nó không vang từ một hướng cụ thể, mà như thể chính không khí, chính ánh sáng còn sót lại đang cất lời, chạm đến sâu thẳm từng linh hồn đang run rẩy vì sợ hãi và hy vọng.</p>
                    <p><em>“Ta đã trao cho các ngươi tự do, món quà quý giá nhất, nền tảng của chính sự tồn tại có ý thức. Ta trao nó không phải để các ngươi phục tùng một cách mù quáng, mà để các ngươi tự kiến tạo số phận, tự học hỏi qua trải nghiệm, và tự trưởng thành trong ánh sáng của chính mình. Ta đã ban kiến thức, lưỡi gươm hai lưỡi, để các ngươi phân biệt thiện ác, để hiểu được giá trị của lựa chọn. Ta đã cho cơ hội sửa sai, vô số lần, ngay cả với kẻ phản bội đầu tiên, kẻ mang ánh sáng nhưng lại chọn bóng tối.”</em></p>
                    <p>Giọng Ngài ngừng lại một nhịp, một khoảng lặng nặng trĩu như chứa đựng nỗi thất vọng của cả một Đấng Sáng Tạo. Tiếng thở dài của Ngài dường như làm cả Thiên Đàng rung động.</p>
                    <p><em>“Nhưng sự cân bằng vẫn vỡ. Tự do, nếu thiếu đi trách nhiệm và sự khiêm nhường, tất yếu sẽ dẫn đến hỗn loạn. Quyền năng, nếu không được dẫn dắt bởi tình yêu thương và sự thấu hiểu, cuối cùng sẽ trở thành công cụ của sự hủy diệt. Các ngươi đã thấy hậu quả. Các ngươi đã nếm trải cái giá của lòng kiêu hãnh và sự mù quáng.”</em></p>
                    <p>Ánh sáng từ Ngai Vàng dịu đi thêm một chút nữa, trở nên mong manh như ánh nến cuối cùng trong đêm. Lời nhắn nhủ cuối cùng thành hình.</p>
                    <p><em>“Giờ đây, Ta trao cho các ngươi bài học cuối cùng, cũng là thử thách lớn nhất, là cơ hội duy nhất để thực sự hiểu được ý nghĩa của những gì Ta đã ban tặng: Trái Đất. Một thế giới hữu hạn, một hạt bụi giữa vũ trụ bao la, nhưng lại chứa đựng sự phức tạp và vẻ đẹp của chính sự sống mong manh. Nơi niềm vui và nỗi đau luôn song hành như ngày và đêm. Nơi sự sống và cái chết là hai mặt của cùng một đồng xu, một phần của vòng tuần hoàn vĩnh cửu mà các ngươi, những kẻ bất tử, chưa bao giờ thực sự thấu hiểu.”</em></p>
                    <p>Giọng Ngài trở nên tha thiết hơn, như một lời ủy thác đầy tin tưởng nhưng cũng ẩn chứa sự nghiêm khắc.</p>
                    <p><em>“Hãy xuống đó. Tạm quên đi đôi cánh và quyền năng. Hãy học cách tồn tại như những sinh vật yếu đuối bằng xương bằng thịt mà các ngươi từng coi thường. Hãy học cách yêu thương khi không còn sự bất tử làm điểm tựa, khi mỗi khoảnh khắc đều trở nên quý giá. Hãy học cách tìm thấy ánh sáng trong chính sự hữu hạn, trong bóng tối của khổ đau, trong những lựa chọn nhỏ bé hàng ngày giữa thiện và ác. Đó là trường học cuối cùng. Nơi các ngươi phải đối mặt với chính bản ngã trần trụi nhất, nơi các ngươi phải chứng minh giá trị thực sự của linh hồn mình, không phải bằng sức mạnh, mà bằng sự trưởng thành.”</em></p>
                    <p>Và rồi, lời nói cuối cùng vang lên, không phải lời từ biệt, mà là một sự khẳng định về một kỷ nguyên mới của tự do và trách nhiệm:</p>
                    <p><em>“Từ nay, quyền lựa chọn và hậu quả hoàn toàn thuộc về các ngươi. Ta sẽ lùi lại, quan sát sự trưởng thành của các ngươi trong tự do đích thực.”</em></p>
                    <p>Dứt lời, ánh sáng rực rỡ trên Ngai Vàng không tắt hẳn, mà thu mình lại, rút khỏi sự biểu lộ trực tiếp. Nó không còn là mặt trời soi chiếu mọi ngóc ngách, mà trở thành một vầng hào quang xa xôi, một sự hiện diện tiềm ẩn, như trái tim vũ trụ vẫn đập nhưng không còn can dự vào từng hơi thở. Cảm giác về sự hiện diện toàn năng, trực tiếp của Thiên Chúa biến mất khỏi Thiên Đàng.</p>
                    <p>Cùng với sự rút lui đó, nguồn năng lượng thiêng liêng từng nuôi dưỡng và duy trì trật tự hoàn hảo của Thiên Đàng cũng ngừng tuôn chảy trực tiếp. Sự mất mát này giống như không khí bị rút khỏi lồng ngực, như hơi ấm đột ngột rời đi giữa mùa đông giá rét.</p>
                    <p>Một sự im lặng chết chóc, nặng nề hơn cả trước đó, bao trùm Đại Điện. Rồi, sự sụp đổ thực sự bắt đầu. Không còn năng lượng thần thánh trực tiếp duy trì, các cấu trúc vĩ đại của Thiên Đàng bắt đầu lung lay. Tiếng đổ vỡ vang lên từ khắp nơi. Các ngọn tháp ánh sáng mờ dần rồi rạn nứt. Những bức tường pha lê, biểu tượng của sự vĩnh cửu, xuất hiện thêm vô số vết nứt sâu hoắm. Bản giao hưởng thiên giới im bặt, thay vào đó là những âm thanh hỗn loạn, lạc điệu của sự tan rã và nỗi kinh hoàng.</p>
                    <p>Nỗi sợ hãi ban đầu biến thành sự hoảng loạn tột độ. Các thiên thần la hét, bay tán loạn trong vô vọng, cố gắng níu kéo chút trật tự cuối cùng đang tan rã như cát bụi.</p>
                    <p>Michael gầm lên một tiếng tuyệt vọng, thanh kiếm vàng trong tay ông chỉ còn là ánh sáng yếu ớt. Ông cố gắng tập hợp các Tổng lãnh thiên thần còn lại: <em>“Giữ vững hàng ngũ! Bảo vệ trung tâm! Đừng hoảng loạn!”</em> Nhưng mệnh lệnh của ông lạc lõng giữa biển hỗn loạn. Quyền năng của ông, vốn được nuôi dưỡng bởi ánh sáng Thiên Chúa, giờ đây suy yếu trầm trọng. Gabriel đứng lặng, cây trượng bạc trong tay ông mờ đi, đôi mắt vàng nhìn lên Ngai Vàng giờ chỉ còn là một khối kiến trúc trống rỗng, tràn ngập nỗi tuyệt vọng.</p>
                    <p>Ở nơi xa xăm của vực thẳm, Lucifer cũng cảm nhận được sự thay đổi chấn động này – sự rút lui của Ánh Sáng Tối Cao. Một nụ cười nửa miệng thoáng nở trên môi - cơ hội đã đến? Nhưng rồi hắn cảm nhận được sự bất ổn lan rộng, sự hỗn loạn không chỉ giới hạn ở Thiên Đàng. Sự rút lui này đồng nghĩa với việc mọi quy luật cũ đều bị phá vỡ. Một vũ trụ không có sự can thiệp trực tiếp của Đấng Sáng Tạo... liệu có thực sự là tự do mà hắn mong muốn, hay là một sự hỗn loạn còn đáng sợ hơn?</p>
                    <p>Câu trả lời đến gần như ngay lập tức.</p>
                    <p>Bầu trời phía trên Thiên Đàng đang sụp đổ, và cả phía trên Địa Ngục đang rung chuyển, đột nhiên bị xé toạc bởi một lực lượng vô hình. Một vết nứt không gian khổng lồ, đen ngòm và sâu thẳm, mở ra như một con mắt vũ trụ đang nhìn xuống. Nó không phát ra ánh sáng hay bóng tối, chỉ có một lực hút kinh hoàng, vô hình, bắt đầu kéo mọi thứ về phía nó - những mảnh vỡ lấp lánh của các công trình Thiên Đàng, những linh hồn đang hoảng loạn, cả ánh sáng le lói còn sót lại và bóng tối của vực thẳm.</p>
                    <p><em>Thiên Đàng đang thực sự tan rã. Và một cơn mưa định mệnh sắp trút xuống.</em></p>
                </div>
            </div>
    

        </div> <div class="navigation flex flex-col sm:flex-row justify-between items-center mt-10 mb-6 space-y-4 sm:space-y-0">
            <button id="list-chapter-btn" class="w-full sm:w-auto px-6 py-3 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center">
                <i class="fas fa-list-ul mr-2"></i>Danh Sách Chương
            </button>
            <button id="prev-chapter-btn" class="w-full sm:w-auto px-6 py-3 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center" disabled>
                <i class="fas fa-arrow-left mr-2"></i>Chương Sau
            </button>
            <button id="next-chapter-btn" class="w-full sm:w-auto px-6 py-3 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-300 ease-in-out transform hover:scale-105 flex items-center justify-center">
                Chương Tiếp<i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>
    </main>

    <div id="chapter-modal" class="modal fixed inset-0 bg-black bg-opacity-60 dark:bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300 ease-in-out opacity-0 pointer-events-none" style="/* display: none; is controlled by JS adding modal-active class */">
        <div class="modal-content bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-lg shadow-2xl w-full max-w-md relative transform transition-all duration-300 ease-in-out scale-95 opacity-0">
            <span id="close-modal-btn" class="close absolute top-3 right-4 text-gray-500 dark:text-gray-400 hover:text-red-600 dark:hover:text-red-400 text-3xl cursor-pointer transition-colors leading-none">&times;</span>
            <h3 class="text-2xl font-semibold mb-6 text-gray-800 dark:text-white">Danh Sách Chương</h3>
            <ul id="modal-chapter-list" class="space-y-1 max-h-80 sm:max-h-96 overflow-y-auto pr-2">
                <li><a href="#chapter-1" data-chapter-id="chapter-1" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 1: Lời Tạm Biệt Trên Ngai Vàng</a></li>
                <li><a href="#chapter-2" data-chapter-id="chapter-2" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 2: Mưa Sao Băng Linh Hồn</a></li>
                <li><a href="#chapter-3" data-chapter-id="chapter-3" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 3: Sự Sa Ngã & Thiên Đàng Sau Biến Cố</a></li>
                <li><a href="#chapter-4" data-chapter-id="chapter-4" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 4: Tiếng Gọi Của Lòng Trắc Ẩn</a></li>
                <li><a href="#chapter-5" data-chapter-id="chapter-5" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 5: Giữa Đám Đông & Góc Khuất Của Tâm Hồn</a></li>
                <li><a href="#chapter-6" data-chapter-id="chapter-6" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 6: Bóng Tối Của Lòng Từ Thiện</a></li>
                <li><a href="#chapter-7" data-chapter-id="chapter-7" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 7: Những Lựa Chọn Trong Bóng Tối</a></li>
                <li><a href="#chapter-8" data-chapter-id="chapter-8" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 8: Bước Vào Thế Giới Mới</a></li>
                <li><a href="#chapter-9" data-chapter-id="chapter-9" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 9: Những Bài Học Đầu Tiên</a></li>
                <li><a href="#chapter-10" data-chapter-id="chapter-10" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 10: Chuyến Đi Đến Los Angeles</a></li>
                <li><a href="#chapter-11" data-chapter-id="chapter-11" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 11: Những Cuộc Gặp Gỡ Đầu Tiên</a></li>
                <li><a href="#chapter-12" data-chapter-id="chapter-12" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 12: Sương Mù Của Đàm Phán</a></li>
                <li><a href="#chapter-13" data-chapter-id="chapter-13" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 13: Bóng Tối Của Quá Khứ</a></li>
                <li><a href="#chapter-14" data-chapter-id="chapter-14" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 14: Con Đường Ý Chí Của Quỷ</a></li>
                <li><a href="#chapter-15" data-chapter-id="chapter-15" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 15: Tiếng Vọng Từ Thiên Đàng</a></li>
                <li><a href="#chapter-16" data-chapter-id="chapter-16" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 16: Hành Trình Trong Bóng Tối</a></li>
                <li><a href="#chapter-17" data-chapter-id="chapter-17" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 17: Gặp Gỡ Người Đầu Tiên</a></li>
                <li><a href="#chapter-18" data-chapter-id="chapter-18" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 18: Lửa Và Ánh Sáng</a></li>
                <li><a href="#chapter-19" data-chapter-id="chapter-19" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 19: Cái Bẫy Của Lucifer</a></li>
                <li><a href="#chapter-20" data-chapter-id="chapter-20" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 20: Hành Trình Đến Vùng Đất Bóng Tối</a></li>
                <li><a href="#chapter-21" data-chapter-id="chapter-21" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 21: Cuộc Đối Đầu Định Mệnh</a></li>
                <li><a href="#chapter-22" data-chapter-id="chapter-22" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 22: Bình Minh Giữa Tro Tàn</a></li>
                <li><a href="#chapter-23" data-chapter-id="chapter-23" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 23: Dấu Vết Đầu Tiên Và Cuộc Gọi Bị Chặn</a></li>
                <li><a href="#chapter-24" data-chapter-id="chapter-24" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 24: Chạm Vào Bí Mật Thiêng Liêng</a></li>
                <li><a href="#chapter-25" data-chapter-id="chapter-25" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 25: Lời Thì Thầm Của Kẻ Cám Dỗ</a></li>
                <li><a href="#chapter-26" data-chapter-id="chapter-26" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 26: Con Đường Chia Rẽ</a></li>
                <li><a href="#chapter-27" data-chapter-id="chapter-27" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 27: Cuộc Truy Đuổi Gắt Gao</a></li>
                <li><a href="#chapter-28" data-chapter-id="chapter-28" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 28: Tạo Vật Cổ Xưa Và Sự Thật Méo Mó</a></li>
                <li><a href="#chapter-29" data-chapter-id="chapter-29" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 29: Hợp Nhất Ánh Sáng Và Trí Tuệ</a></li>
                <li><a href="#chapter-30" data-chapter-id="chapter-30" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 30: Bình Minh Của Sự Cân Bằng</a></li>
                <li><a href="#chapter-31" data-chapter-id="chapter-31" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 31: Tiếng Gọi Từ Quê Nhà</a></li>
                <li><a href="#chapter-32" data-chapter-id="chapter-32" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 32: Manh Mối Mới Và Sự Trỗi Dậy</a></li>
                <li><a href="#chapter-33" data-chapter-id="chapter-33" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 33: Gặp Gỡ Kẻ Phản Bội?</a></li>
                <li><a href="#chapter-34" data-chapter-id="chapter-34" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 34: Cái Giá Của Hy Vọng</a></li>
                <li><a href="#chapter-35" data-chapter-id="chapter-35" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 35: Liên Minh Mong Manh Và Nỗi Nhớ Khôn Nguôi</a></li>
                <li><a href="#chapter-36" data-chapter-id="chapter-36" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 36: Lựa Chọn Của Người Chữa Lành</a></li>
                <li><a href="#chapter-37" data-chapter-id="chapter-37" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 37: Trận Chiến Cuối Cùng Vì Sự Cân Bằng</a></li>
                <li><a href="#chapter-38" data-chapter-id="chapter-38" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 38: Sự Hy Sinh Của Trái Tim</a></li>
                <li><a href="#chapter-39" data-chapter-id="chapter-39" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 39: Trật Tự Mới Và Lời Từ Biệt Thầm Lặng</a></li>
                <li><a href="#chapter-40" data-chapter-id="chapter-40" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chương 40: Người Giữ Cân Bằng (Kết Thúc Mở)</a></li>
                <li><a href="#epilogue" data-chapter-id="epilogue" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Lời Kết</a></li>
                <li><a href="#after-credit" data-chapter-id="after-credit" class="modal-chapter-link block p-3 rounded-md text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Phần Sau</a></li>
            </ul>
        </div>
    </div>

    <footer id="footer" class="bg-gray-100 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 transition-colors duration-300 ease-in-out">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center">
            <div class="footer-links mb-6 space-x-2 sm:space-x-4">
                <a href="legnaxe_part2_en.html" class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 text-sm sm:text-base transition-colors">English Version</a>
                <a href="author-about.html" class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 text-sm sm:text-base transition-colors">Về Tác Giả</a>
            </div>
            <p class="text-sm text-gray-500 dark:text-gray-400">© <span id="current-year">2025</span> LEGNAXE. All rights reserved. Author:NMT</p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">Website: <a href="https://ivs.id.vn" target="_blank" rel="noopener noreferrer" class="hover:underline">ivs.id.vn</a></p>
        </div>
    </footer>
    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end space-y-3"></div>
        <a href="https://zalo.me/ivsjsc" target="_blank" rel="noopener noreferrer"
           class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-500 text-white shadow-lg hover:bg-blue-600 transition-colors duration-200"
           aria-label="Chat on Zalo OA">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="30" height="30" viewBox="0 0 50 50" fill="currentColor"></svg>
                 <path d="M 9 4 C 6.2504839 4 4 6.2504839 4 9 L 4 41 C 4 43.749516 6.2504839 46 9 46 L 41 46 C 43.749516 46 46 43.749516 46 41 L 46 9 C 46 6.2504839 43.749516 4 41 4 L 9 4 z M 9 6 L 15.580078 6 C 12.00899 9.7156859 10 14.518083 10 19.5 C 10 24.66 12.110156 29.599844 15.910156 33.339844 C 16.030156 33.549844 16.129922 34.579531 15.669922 35.769531 C 15.379922 36.519531 14.799687 37.499141 13.679688 37.869141 C 13.249688 38.009141 12.97 38.430859 13 38.880859 C 13.03 39.330859 13.360781 39.710781 13.800781 39.800781 C 16.670781 40.370781 18.529297 39.510078 20.029297 38.830078 C 21.379297 38.210078 22.270625 37.789609 23.640625 38.349609 C 26.440625 39.439609 29.42 40 32.5 40 C 36.593685 40 40.531459 39.000731 44 37.113281 L 44 41 C 44 42.668484 42.668484 44 41 44 L 9 44 C 7.3315161 44 6 42.668484 6 41 L 6 9 C 6 7.3315161 7.3315161 6 9 6 z M 33 15 C 33.55 15 34 15.45 34 16 L 34 25 C 34 25.55 33.55 26 33 26 C 32.45 26 32 25.55 32 25 L 32 16 C 32 15.45 32.45 15 33 15 z M 18 16 L 23 16 C 23.36 16 23.700859 16.199531 23.880859 16.519531 C 24.050859 16.829531 24.039609 17.219297 23.849609 17.529297 L 19.800781 24 L 23 24 C 23.55 24 24 24.45 24 25 C 24 25.55 23.55 26 23 26 L 18 26 C 17.64 26 17.299141 25.800469 17.119141 25.480469 C 16.949141 25.170469 16.960391 24.780703 17.150391 24.470703 L 21.199219 18 L 18 18 C 17.45 18 17 17.55 17 17 C 17 16.45 17.45 16 18 16 z M 27.5 19 C 28.11 19 28.679453 19.169219 29.189453 19.449219 C 29.369453 19.189219 29.65 19 30 19 C 30.55 19 31 19.45 31 20 L 31 25 C 31 25.55 30.55 26 30 26 C 29.65 26 29.369453 25.810781 29.189453 25.550781 C 28.679453 25.830781 28.11 26 27.5 26 C 25.57 26 24 24.43 24 22.5 C 24 20.57 25.57 19 27.5 19 z M 38.5 19 C 40.43 19 42 20.57 42 22.5 C 42 24.43 40.43 26 38.5 26 C 36.57 26 35 24.43 35 22.5 C 35 20.57 36.57 19 38.5 19 z M 27.5 21 C 27.39625 21 27.29502 21.011309 27.197266 21.03125 C 27.001758 21.071133 26.819727 21.148164 26.660156 21.255859 C 26.500586 21.363555 26.363555 21.500586 26.255859 21.660156 C 26.148164 21.819727 26.071133 22.001758 26.03125 22.197266 C 26.011309 22.29502 26 22.39625 26 22.5 C 26 22.60375 26.011309 22.70498 26.03125 22.802734 C 26.051191 22.900488 26.079297 22.994219 26.117188 23.083984 C 26.155078 23.17375 26.202012 23.260059 26.255859 23.339844 C 26.309707 23.419629 26.371641 23.492734 26.439453 23.560547 C 26.507266 23.628359 26.580371 23.690293 26.660156 23.744141 C 26.819727 23.851836 27.001758 23.928867 27.197266 23.96875 C 27.29502 23.988691 27.39625 24 27.5 24 C 27.60375 24 27.70498 23.988691 27.802734 23.96875 C 28.487012 23.82916 29 23.22625 29 22.5 C 29 21.67 28.33 21 27.5 21 z M 38.5 21 C 38.39625 21 38.29502 21.011309 38.197266 21.03125 C 38.099512 21.051191 38.005781 21.079297 37.916016 21.117188 C 37.82625 21.155078 37.739941 21.202012 37.660156 21.255859 C 37.580371 21.309707 37.507266 21.371641 37.439453 21.439453 C 37.303828 21.575078 37.192969 21.736484 37.117188 21.916016 C 37.079297 22.005781 37.051191 22.099512 37.03125 22.197266 C 37.011309 22.29502 37 22.39625 37 22.5 C 37 22.60375 37.011309 22.70498 37.03125 22.802734 C 37.051191 22.900488 37.079297 22.994219 37.117188 23.083984 C 37.155078 23.17375 37.202012 23.260059 37.255859 23.339844 C 37.309707 23.419629 37.371641 23.492734 37.439453 23.560547 C 37.507266 23.628359 37.580371 23.690293 37.660156 23.744141 C 37.739941 23.797988 37.82625 23.844922 37.916016 23.882812 C 38.005781 23.920703 38.099512 23.948809 38.197266 23.96875 C 38.29502 23.988691 38.39625 24 38.5 24 C 38.60375 24 38.70498 23.988691 38.802734 23.96875 C 39.487012 23.82916 40 23.22625 40 22.5 C 40 21.67 39.33 21 38.5 21 z"></path>
            </svg>
        </a>     
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const chapters = Array.from(document.querySelectorAll('.chapter'));
        let currentChapterIndex = 0;

        const prevButton = document.getElementById('prev-chapter-btn');
        const nextButton = document.getElementById('next-chapter-btn');
        const listChapterButton = document.getElementById('list-chapter-btn');

        const chapterModal = document.getElementById('chapter-modal');
        const closeModalButton = document.getElementById('close-modal-btn');
        const modalChapterLinks = document.querySelectorAll('.modal-chapter-link');

        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body; // documentElement is better for 'dark' class on <html>
        const htmlElement = document.documentElement;
        const themeIcon = themeToggle ? themeToggle.querySelector('i') : null;
        const currentYearSpan = document.getElementById('current-year');


        function showChapter(index, isInitialLoad = false) {
            if (index < 0 || index >= chapters.length) return;

            chapters.forEach((chapter, i) => {
                chapter.classList.toggle('active', i === index);
            });

            if (prevButton) prevButton.disabled = index === 0;
            if (nextButton) nextButton.disabled = index === chapters.length - 1;

            currentChapterIndex = index;
            if (!isInitialLoad) {
                const storyContentWrapper = document.querySelector('.story-content-wrapper');
                if (storyContentWrapper) {
                     // Scrolls to the top of the main content area, not the chapter itself
                    window.scrollTo({
                        top: storyContentWrapper.offsetTop - document.getElementById('navbar').offsetHeight - 20, // Adjust offset as needed
                        behavior: 'smooth'
                    });
                } else {
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
             // Update hash in URL
            if (chapters[currentChapterIndex]) {
                 // Only update hash if not initial load to prevent jump if already on target
                if(!isInitialLoad) window.location.hash = chapters[currentChapterIndex].id;
            }
        }
        
        function showChapterFromHash(isInitialLoad = false) {
            const hash = window.location.hash.substring(1);
            if (hash) {
                const targetIndex = chapters.findIndex(chap => chap.id === hash);
                if (targetIndex !== -1) {
                    showChapter(targetIndex, isInitialLoad);
                    return true; // Hash was found and chapter shown
                }
            }
            return false; // No valid hash found
        }


        // Event Listeners for Chapter Navigation
        if (prevButton) {
            prevButton.addEventListener('click', () => {
                if (currentChapterIndex > 0) {
                    showChapter(currentChapterIndex - 1);
                }
            });
        }

        if (nextButton) {
            nextButton.addEventListener('click', () => {
                if (currentChapterIndex < chapters.length - 1) {
                    showChapter(currentChapterIndex + 1);
                }
            });
        }

        // Modal Logic
        if (listChapterButton && chapterModal) {
            listChapterButton.addEventListener('click', () => {
                chapterModal.style.display = 'flex'; // Make it visible for transition
                setTimeout(() => { // Allow display to take effect
                    chapterModal.classList.add('modal-active');
                }, 10); // Small delay
                body.style.overflow = 'hidden'; // Prevent background scroll
            });
        }

        function closeModal() {
            if (chapterModal) {
                chapterModal.classList.remove('modal-active');
                // Wait for opacity transition before setting display to none
                setTimeout(() => {
                    // Check if modal wasn't re-opened quickly
                    if (!chapterModal.classList.contains('modal-active')) {
                         chapterModal.style.display = 'none';
                    }
                }, 300); // Match CSS transition duration
                 body.style.overflow = ''; // Restore background scroll
            }
        }

        if (closeModalButton) {
            closeModalButton.addEventListener('click', closeModal);
        }

        if (chapterModal) { // Close modal if clicking on backdrop
            chapterModal.addEventListener('click', (event) => {
                if (event.target === chapterModal) {
                    closeModal();
                }
            });
        }

        modalChapterLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const chapterId = link.getAttribute('href').substring(1);
                const targetIndex = chapters.findIndex(chap => chap.id === chapterId);

                if (targetIndex !== -1) {
                    showChapter(targetIndex);
                }
                closeModal();
            });
        });

        // Theme Toggle Logic
        function applyTheme(isDark) {
            htmlElement.classList.toggle('dark', isDark); // Apply to <html> for global dark styles like scrollbar
            // body.classList.toggle('dark', isDark); // Already handled by html.dark if using Tailwind
            if (themeIcon) {
                themeIcon.classList.toggle('fa-moon', !isDark);
                themeIcon.classList.toggle('fa-sun', isDark);
            }
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedTheme = localStorage.getItem('theme');
        let currentIsDarkMode = savedTheme === 'dark' || (savedTheme === null && prefersDarkScheme);

        applyTheme(currentIsDarkMode); // Apply initial theme

        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                currentIsDarkMode = !htmlElement.classList.contains('dark');
                applyTheme(currentIsDarkMode);
            });
        }

        // Initial Chapter Load
        if (chapters.length > 0) {
            if (!showChapterFromHash(true)) { // Try loading from hash first (true for initialLoad)
                showChapter(0, true); // If no hash, show first chapter (true for initialLoad)
            }
        } else {
            if (prevButton) prevButton.disabled = true;
            if (nextButton) nextButton.disabled = true;
        }
        
        // Update year in footer
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        // Handle hash changes (e.g. browser back/forward buttons)
        window.addEventListener('hashchange', () => showChapterFromHash(false));

    });
    </script>
</body>
</html>