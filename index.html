<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVS JSC - Integrate Vision Synergy</title>
    <meta name="description" content="IVS JSC - Công ty Cổ phần Dịch vụ Thương mại Integrate Vision Synergy. Cung cấp giải pháp giáo dục toàn diện, đào tạo quốc tế, công nghệ giáo dục và hợp tác đầu tư.">
    <meta name="keywords" content="IVS JSC, Integrate Vision Synergy, Giáo dục quốc tế, Đào tạo ngoại ngữ, STEAM, Kỹ năng mềm, Du học, Hợp tác quốc tế, Công nghệ giáo dục, EdTech, IVS Academy, IVS Kindergarten, IVS Celestech, Nguyễn Minh Triết">
    <link rel="stylesheet" href="css/styles.min.css?v=1.6"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />

    <script>
        /**
         * Tải các thành phần HTML (header, footer) từ các tệp riêng biệt.
         */
        function includeHTML() {
            var z, i, elmnt, file, xhttp;
            z = document.getElementsByTagName("*");
            for (i = 0; i < z.length; i++) {
                elmnt = z[i];
                file = elmnt.getAttribute("data-include");
                if (file) {
                    xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4) {
                            if (this.status == 200) {elmnt.innerHTML = this.responseText;}
                            if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
                            elmnt.removeAttribute("data-include");
                            includeHTML(); // Gọi lại để xử lý các include lồng nhau (nếu có)
                        }
                    }
                    xhttp.open("GET", file, true);
                    xhttp.send();
                    return; // Thoát sau khi tìm thấy một phần tử để include
                }
            }
            // Thêm class 'active' cho link điều hướng hiện tại sau khi include xong
            setActiveNavLink();
        }

        /**
         * Đánh dấu link điều hướng đang hoạt động dựa trên trang hiện tại.
         */
        function setActiveNavLink() {
            // Đảm bảo header đã được tải xong trước khi tìm link
            const header = document.querySelector('header');
            if (!header || header.getAttribute('data-include')) return; // Chờ header tải xong

            const navLinks = document.querySelectorAll('header nav ul li a');
            // Lấy tên tệp hiện tại (index.html nếu là trang gốc)
            const currentPath = window.location.pathname.split('/').pop() || 'index.html';
            navLinks.forEach(link => {
                // Lấy tên tệp từ thuộc tính href
                const linkPath = (link.getAttribute('href') || '').split('/').pop();
                if (linkPath === currentPath) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        /**
         * Tải và hiển thị các bài viết mới nhất từ posts.json.
         */
        function loadLatestPosts() {
            const postsContainer = document.getElementById('latest-posts-container');
            if (!postsContainer) {
                console.warn('Latest posts container not found.');
                return;
            }
            postsContainer.innerHTML = '<p>Đang tải bài viết...</p>'; // Hiển thị trạng thái tải

            fetch('posts.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const contentType = response.headers.get("content-type");
                     if (!contentType || !contentType.includes("application/json")) {
                        throw new TypeError("Received non-JSON response for posts.json");
                    }
                    return response.json();
                })
                .then(posts => {
                    // Sắp xếp bài viết theo ngày giảm dần (mới nhất trước)
                    posts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    // Lấy 3 bài viết mới nhất
                    const latestPosts = posts.slice(0, 3);

                    let postsHTML = '';
                    if (latestPosts.length === 0) {
                         postsHTML = '<p>Chưa có bài viết nào.</p>';
                    } else {
                        latestPosts.forEach(post => {
                            // Tạo HTML cho mỗi thẻ bài viết
                            postsHTML += `
                                <div class="post-card">
                                    <img src="${post.image || 'https://placehold.co/600x400/eee/ccc?text=Post'}" alt="${post.title || 'Bài viết'}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/eee/ccc?text=Image+Error';">
                                    <div class="post-content">
                                        <h3>${post.title || 'Tiêu đề bài viết'}</h3>
                                        <p class="post-meta">Ngày đăng: ${post.date ? new Date(post.date).toLocaleDateString('vi-VN') : 'Không rõ'}</p>
                                        <p>${post.excerpt || ''}</p>
                                        <a href="${post.url || '#'}" class="read-more">Đọc thêm</a>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    postsContainer.innerHTML = postsHTML; // Hiển thị các bài viết
                })
                .catch(error => {
                    console.error('Error loading latest posts:', error);
                    postsContainer.innerHTML = `<p class="error-message">Không thể tải danh sách bài viết. (${error.message})</p>`; // Hiển thị lỗi
                });
        }

        /**
         * Tải và hiển thị các bài viết nổi bật (hot: true) từ posts.json vào Swiper slider.
         */
        function loadFeaturedPosts() {
            const swiperWrapper = document.querySelector('.featured-swiper-container .swiper-wrapper');
            if (!swiperWrapper) {
                 console.warn('Featured posts swiper wrapper not found.');
                 return;
            }
             swiperWrapper.innerHTML = '<p class="text-center p-4">Đang tải thông tin nổi bật...</p>'; // Trạng thái tải

            fetch('posts.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const contentType = response.headers.get("content-type");
                     if (!contentType || !contentType.includes("application/json")) {
                        throw new TypeError("Received non-JSON response for posts.json");
                    }
                    return response.json();
                })
                .then(posts => {
                    // Lọc các bài viết có hot: true
                    const featuredPosts = posts.filter(post => post.hot === true);

                    let slidesHTML = '';
                    const swiperContainer = document.querySelector('.featured-swiper-container'); // Lấy container để ẩn/hiện nav/pag

                    if (featuredPosts.length === 0) {
                        slidesHTML = '<p class="text-center p-4">Hiện chưa có thông tin nổi bật.</p>';
                         // Ẩn navigation/pagination nếu không có slide
                         if(swiperContainer) {
                             const pagination = swiperContainer.querySelector('.swiper-pagination');
                             const nextBtn = swiperContainer.querySelector('.swiper-button-next');
                             const prevBtn = swiperContainer.querySelector('.swiper-button-prev');
                             if(pagination) pagination.style.display = 'none';
                             if(nextBtn) nextBtn.style.display = 'none';
                             if(prevBtn) prevBtn.style.display = 'none';
                         }
                    } else {
                         // Hiện navigation/pagination nếu có slide
                         if(swiperContainer) {
                             const pagination = swiperContainer.querySelector('.swiper-pagination');
                             const nextBtn = swiperContainer.querySelector('.swiper-button-next');
                             const prevBtn = swiperContainer.querySelector('.swiper-button-prev');
                             if(pagination) pagination.style.display = 'block'; // Hoặc giá trị display mặc định
                             if(nextBtn) nextBtn.style.display = 'flex'; // Hoặc giá trị display mặc định
                             if(prevBtn) prevBtn.style.display = 'flex'; // Hoặc giá trị display mặc định
                         }
                        featuredPosts.forEach(post => {
                             // Tạo HTML cho mỗi slide
                            slidesHTML += `
                                <div class="swiper-slide">
                                    <div class="featured-card">
                                        <img src="${post.image || 'https://placehold.co/400x250/eee/ccc?text=Featured'}" alt="${post.title || 'Nổi bật'}" onerror="this.onerror=null;this.src='https://placehold.co/400x250/eee/ccc?text=Image+Error';">
                                        <h3>${post.title || 'Tiêu đề'}</h3>
                                        <p>${post.excerpt || ''}</p>
                                        <a href="${post.url || '#'}" class="read-more">Xem chi tiết</a>
                                    </div>
                                </div>
                            `;
                        });
                         // Khởi tạo Swiper CHỈ KHI có slide
                        initializeFeaturedSwiper();
                    }
                    swiperWrapper.innerHTML = slidesHTML; // Hiển thị các slide hoặc thông báo

                })
                .catch(error => {
                    console.error('Error loading featured posts:', error);
                    swiperWrapper.innerHTML = `<p class="error-message text-center p-4">Không thể tải thông tin nổi bật. (${error.message})</p>`;
                     // Ẩn navigation/pagination khi có lỗi
                     const swiperContainer = document.querySelector('.featured-swiper-container');
                     if(swiperContainer) {
                         const pagination = swiperContainer.querySelector('.swiper-pagination');
                         const nextBtn = swiperContainer.querySelector('.swiper-button-next');
                         const prevBtn = swiperContainer.querySelector('.swiper-button-prev');
                         if(pagination) pagination.style.display = 'none';
                         if(nextBtn) nextBtn.style.display = 'none';
                         if(prevBtn) prevBtn.style.display = 'none';
                     }
                });
        }

        /**
         * Khởi tạo Swiper slider cho khu vực nổi bật.
         * Chỉ được gọi sau khi các slide đã được tạo và thêm vào DOM.
         */
        function initializeFeaturedSwiper() {
             // Kiểm tra xem Swiper đã được khởi tạo trên element này chưa
             const swiperContainer = document.querySelector('.featured-swiper-container');
             if (swiperContainer && swiperContainer.swiper) {
                 // Nếu đã có, có thể cập nhật hoặc hủy và tạo mới nếu cần
                 // swiperContainer.swiper.update();
                 return; // Hoặc return nếu không muốn khởi tạo lại
             }

             const featuredSwiper = new Swiper('.featured-swiper-container', {
                slidesPerView: 2.0,   // Hiển thị 2 thẻ trên mobile
                spaceBetween: 12,     // Giảm khoảng cách trên mobile
                // Chỉ bật loop nếu có đủ slide (ví dụ: nhiều hơn số slide hiển thị)
                // loop: featuredPosts.length > 3, // Ví dụ logic kiểm tra số lượng slide
                loop: true, // Tạm thời để true, có thể chỉnh lại logic nếu cần

                breakpoints: {
                    640: {
                      slidesPerView: 2.3,
                      spaceBetween: 20,
                    },
                    1024: {
                      slidesPerView: 3,
                      spaceBetween: 30,
                    }
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                grabCursor: true,
                keyboard: {
                    enabled: true,
                },
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false,
                    pauseOnMouseEnter: true, // Tạm dừng khi hover chuột
                },
            });
        }

    </script>
    </head>
<body>
    <header data-include="header.html"></header>

    <main>
        <section class="hero">
            <h1>Chào mừng đến với IVS JSC</h1>
            <p>Kết nối Tầm nhìn - Đồng lòng Sức mạnh - Vì một Tương lai Giáo dục Vượt trội</p>
            <a href="about.html" class="cta-button">Tìm hiểu thêm</a>
        </section>

        <section class="featured-section">
            <h2>Thông Tin Nổi Bật</h2>
            <div class="swiper featured-swiper-container">
                <div class="swiper-wrapper">
                    </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </section>

        <section id="latest-posts" class="latest-posts">
            <h2>Bài viết mới nhất</h2>
            <div id="latest-posts-container" class="posts-grid">
                 </div>
        </section>

        <section class="consultation-form-section">
            <div class="container">
                <h2>Nhận Tư Vấn Miễn Phí</h2>
                <p class="section-subtitle">
                    Bạn quan tâm đến các chương trình đào tạo, du học, hợp tác đầu tư hay các giải pháp giáo dục khác của IVS JSC?
                    Hãy để lại thông tin qua biểu mẫu dưới đây, chúng tôi sẽ liên hệ lại với bạn sớm nhất!
                </p>
                <div class="google-form-container">
                    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfZYlHLmWEzkB4jEFAoyNUi0GlP1HyCwafN_thY8tVkH_h6uQ/viewform?embedded=true" width="100%" height="1000" frameborder="0" marginheight="0" marginwidth="0">Đang tải…</iframe>
                    </div>
            </div>
        </section>
        </main>

    <footer data-include="footer.html"></footer>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <script src="js/main.min.js?v=1.1"></script> <script>
        document.addEventListener("DOMContentLoaded", function() {
            includeHTML(); // Tải header/footer trước
            // Sau đó tải nội dung động
            loadFeaturedPosts();
            loadLatestPosts();
        });
    </script>
</body>
</html>
