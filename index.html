<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVS JSC - Integrate Vision Synergy</title>
    <meta name="description" content="IVS JSC - Công ty Cổ phần Dịch vụ Thương mại Integrate Vision Synergy. Cung cấp giải pháp giáo dục toàn diện, đào tạo quốc tế, công nghệ giáo dục và hợp tác đầu tư.">
    <meta name="keywords" content="IVS JSC, Integrate Vision Synergy, Giáo dục quốc tế, Đào tạo ngoại ngữ, STEAM, Kỹ năng mềm, Du học, Hợp tác quốc tế, Công nghệ giáo dục, EdTech, IVS Academy, IVS Kindergarten, IVS Celestech, Nguyễn Minh Triết">
    <link rel="stylesheet" href="css/styles.min.css?v=1.3"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script>
        // Function to load HTML components (Header, Footer)
        function includeHTML() {
            var z, i, elmnt, file, xhttp;
            z = document.getElementsByTagName("*");
            for (i = 0; i < z.length; i++) {
                elmnt = z[i];
                file = elmnt.getAttribute("data-include");
                if (file) {
                    xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4) {
                            if (this.status == 200) {elmnt.innerHTML = this.responseText;}
                            if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
                            elmnt.removeAttribute("data-include");
                            includeHTML(); // Call again to process nested includes if any
                        }
                    }
                    xhttp.open("GET", file, true);
                    xhttp.send();
                    return; // Exit after finding one element to include
                }
            }
            // Add active class to nav links based on current page
            setActiveNavLink();
        }

        // Function to set active navigation link
        function setActiveNavLink() {
            const navLinks = document.querySelectorAll('header nav ul li a');
            const currentPath = window.location.pathname.split('/').pop() || 'index.html'; // Get current file name
            navLinks.forEach(link => {
                const linkPath = link.getAttribute('href').split('/').pop();
                if (linkPath === currentPath) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        // Function to load latest posts from posts.json
        function loadLatestPosts() {
            const postsContainer = document.getElementById('latest-posts-container');
            if (!postsContainer) return; // Exit if container not found

            fetch('posts.json') // Fetch the JSON file
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(posts => {
                    // Sort posts by date descending (newest first)
                    posts.sort((a, b) => new Date(b.date) - new Date(a.date));
                    // Get the latest 3 posts (or however many you want for this section)
                    const latestPosts = posts.slice(0, 3);

                    let postsHTML = '';
                    if (latestPosts.length === 0) {
                         postsHTML = '<p>Chưa có bài viết nào.</p>';
                    } else {
                        latestPosts.forEach(post => {
                            postsHTML += `
                                <div class="post-card">
                                    <img src="${post.image || 'https://placehold.co/600x400/eee/ccc?text=Post'}" alt="${post.title}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/eee/ccc?text=Image+Error';">
                                    <div class="post-content">
                                        <h3>${post.title}</h3>
                                        <p class="post-meta">Ngày đăng: ${new Date(post.date).toLocaleDateString('vi-VN')}</p>
                                        <p>${post.excerpt}</p>
                                        <a href="${post.url}" class="read-more">Đọc thêm</a>
                                    </div>
                                </div>
                            `;
                        });
                    }
                    postsContainer.innerHTML = postsHTML;
                })
                .catch(error => {
                    console.error('Error loading latest posts:', error);
                    postsContainer.innerHTML = `<p class="error-message">Không thể tải danh sách bài viết. (${error.message})</p>`;
                });
        }

        // Function to load FEATURED posts from posts.json into Swiper
        function loadFeaturedPosts() {
            const swiperWrapper = document.querySelector('.featured-swiper-container .swiper-wrapper');
            if (!swiperWrapper) return;

            fetch('posts.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    // Check content type before parsing
                    const contentType = response.headers.get("content-type");
                     if (!contentType || !contentType.includes("application/json")) {
                        throw new TypeError("Oops, we haven't got JSON!");
                    }
                    return response.json();
                })
                .then(posts => {
                    // Filter for featured posts
                    const featuredPosts = posts.filter(post => post.hot === true);

                    let slidesHTML = '';
                    if (featuredPosts.length === 0) {
                        slidesHTML = '<p class="text-center p-4">Hiện chưa có thông tin nổi bật.</p>'; // Message if no featured posts
                         swiperWrapper.innerHTML = slidesHTML; // Display message directly
                         // Optionally hide navigation/pagination if no slides
                         const swiperContainer = document.querySelector('.featured-swiper-container');
                         if(swiperContainer) {
                             const pagination = swiperContainer.querySelector('.swiper-pagination');
                             const nextBtn = swiperContainer.querySelector('.swiper-button-next');
                             const prevBtn = swiperContainer.querySelector('.swiper-button-prev');
                             if(pagination) pagination.style.display = 'none';
                             if(nextBtn) nextBtn.style.display = 'none';
                             if(prevBtn) prevBtn.style.display = 'none';
                         }
                         return; // Stop if no featured posts
                    }

                    featuredPosts.forEach(post => {
                        slidesHTML += `
                            <div class="swiper-slide">
                                <div class="featured-card">
                                    <img src="${post.image || 'https://placehold.co/400x250/eee/ccc?text=Featured'}" alt="${post.title}" onerror="this.onerror=null;this.src='https://placehold.co/400x250/eee/ccc?text=Image+Error';">
                                    <h3>${post.title}</h3>
                                    <p>${post.excerpt}</p>
                                    <a href="${post.url}" class="read-more">Xem chi tiết</a>
                                </div>
                            </div>
                        `;
                    });
                    swiperWrapper.innerHTML = slidesHTML;

                    // Initialize Swiper AFTER adding slides
                    initializeFeaturedSwiper();
                })
                .catch(error => {
                    console.error('Error loading featured posts:', error);
                    // Display error message inside the wrapper
                    swiperWrapper.innerHTML = `<p class="error-message text-center p-4">Không thể tải thông tin nổi bật. (${error.message})</p>`;
                     // Optionally hide navigation/pagination on error
                     const swiperContainer = document.querySelector('.featured-swiper-container');
                     if(swiperContainer) {
                         const pagination = swiperContainer.querySelector('.swiper-pagination');
                         const nextBtn = swiperContainer.querySelector('.swiper-button-next');
                         const prevBtn = swiperContainer.querySelector('.swiper-button-prev');
                         if(pagination) pagination.style.display = 'none';
                         if(nextBtn) nextBtn.style.display = 'none';
                         if(prevBtn) prevBtn.style.display = 'none';
                     }
                });
        }

        // Function to initialize Swiper (called after slides are loaded)
        function initializeFeaturedSwiper() {
             const featuredSwiper = new Swiper('.featured-swiper-container', {
                // --- OPTIONS FOR MOBILE FIRST ---
                slidesPerView: 2.0,   // **CHANGED:** Hiển thị 2 thẻ trên mobile
                spaceBetween: 12,     // **CHANGED:** Giảm khoảng cách trên mobile
                loop: true,           // Cho phép lặp vô hạn (có thể đặt false nếu ít slide)
                // centeredSlides: false, // **REMOVED:** Không cần căn giữa khi > 1 slide

                // Breakpoints cho responsive
                breakpoints: {
                    // Khi chiều rộng màn hình >= 640px
                    640: {
                      slidesPerView: 2.3, // Hiển thị 2 slide và 1 phần
                      spaceBetween: 20,
                      // centeredSlides: false, // Mặc định là false
                    },
                    // Khi chiều rộng màn hình >= 1024px
                    1024: {
                      slidesPerView: 3, // Hiển thị 3 slide
                      spaceBetween: 30,
                    }
                },

                // Pagination (dấu chấm tròn)
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },

                // Navigation (mũi tên)
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },

                // Tùy chọn thêm
                grabCursor: true,
                keyboard: {
                    enabled: true,
                },
                autoplay: {
                    delay: 5000,
                    disableOnInteraction: false,
                },
            });
        }

    </script>
    <style>
        /* Add small CSS fix for potential header/footer load flash */
        header[data-include], footer[data-include] { min-height: 50px; }
        .error-message { color: red; font-style: italic; } /* Style for error messages */
    </style>
</head>
<body>
    <header data-include="header.html"></header>

    <main>
        <section class="hero">
            <h1>Chào mừng đến với IVS JSC</h1>
            <p>Kết nối Tầm nhìn - Đồng lòng Sức mạnh - Vì một Tương lai Giáo dục Vượt trội</p>
            <a href="about.html" class="cta-button">Tìm hiểu thêm</a>
        </section>

        <section class="featured-section">
            <h2>Thông Tin Nổi Bật</h2>
            <div class="swiper featured-swiper-container">
                <div class="swiper-wrapper">
                    <p class="text-center p-4">Đang tải thông tin nổi bật...</p>
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </section>
        <section id="latest-posts" class="latest-posts">
            <h2>Bài viết mới nhất</h2>
            <div id="latest-posts-container" class="posts-grid">
                <p>Đang tải bài viết...</p>
            </div>
        </section>

        </main>

    <footer data-include="footer.html"></footer>

    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="js/main.min.js?v=1.1"></script> <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener("DOMContentLoaded", function() {
            includeHTML(); // Load header/footer first

            // Load dynamic content
            loadFeaturedPosts(); // **MODIFIED:** Load featured posts dynamically
            loadLatestPosts(); // Load latest posts

            // **REMOVED:** Swiper initialization is now called inside loadFeaturedPosts after slides are ready.
            // initializeFeaturedSwiper();
        });
    </script>
</body>
</html>
