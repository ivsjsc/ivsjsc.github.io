<!-- 
  Thành phần Header Tối ưu cho IVS JSC
  Phiên bản: 2.0 (Mobile-First, All-in-One)
  Ngày cập nhật: 2024-06-10

  Mô tả:
  - Thành phần này bao gồm đầy đủ HTML, CSS, và JavaScript cho header.
  - Được xây dựng theo phương pháp Mobile-First: Giao diện ưu tiên cho di động, 
    sau đó mở rộng cho máy tính bảng và máy tính để bàn.
  - Tích hợp sẵn:
    + Top navigation bar (Desktop) với mega menu và dropdown.
    + Side navigation panel (Mobile - off-canvas).
    + Bottom navigation bar (Mobile) để truy cập nhanh.
  - Đảm bảo tính nhất quán và hiệu suất cao bằng cách loại bỏ việc tải tệp bất đồng bộ.
  - Hướng dẫn tích hợp: Sao chép và dán toàn bộ nội dung của tệp này vào đầu thẻ <body> của mỗi trang HTML.
-->
<style>
    /*
      CSS Variables for consistent theming.
      Using CSS variables allows for easy maintenance and theme switching (e.g., dark mode).
    */
    :root {
        --header-target-height-mobile: 64px;
        --header-target-height-desktop: 80px;
        --ivs-neutral-900: #111827;
        --ivs-neutral-800: #1f2937;
        --ivs-neutral-700: #374151;
        --ivs-neutral-600: #4B5563;
        --ivs-neutral-400: #9ca3af;
        --ivs-neutral-300: #d1d5db;
        --ivs-neutral-200: #e5e7eb;
        --ivs-secondary: #ffc107;
        --ivs-accent: #F97316;
    }

    /* Base Styles for the main header container */
    #main-header {
        height: var(--header-target-height-mobile);
        background-color: var(--ivs-neutral-900);
    }

    /* Desktop Navigation Links & Dropdowns */
    .nav-link, .nav-link-dropdown {
        display: inline-flex;
        align-items: center;
        padding: 6px 10px;
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--ivs-neutral-300);
        transition: color 0.3s, background-color 0.3s;
        border-radius: 0.375rem;
        position: relative;
    }

    .nav-link:hover, .nav-link-dropdown:hover, .nav-link.active {
        color: white;
        background-color: var(--ivs-neutral-700);
    }
    
    .nav-link-icon {
        margin-left: 0.35rem;
        font-size: 0.7rem;
        transition: transform 0.3s ease;
    }

    .group.dropdown-active .nav-link-icon {
        transform: rotate(180deg);
    }
    
    /* Special Buttons: Contact & Language */
    .nav-contact-btn, .nav-lang-btn {
        display: inline-flex;
        align-items: center;
        padding: 6px 12px;
        font-size: 0.9rem;
        font-weight: 600;
        border-radius: 0.375rem;
        transition: all 0.3s ease;
    }

    .nav-contact-btn { background-color: var(--ivs-accent); color: white; }
    .nav-contact-btn:hover { background-color: #ea580c; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(249, 115, 22, 0.3); }

    .nav-lang-btn { border: 1px solid var(--ivs-neutral-700); color: var(--ivs-neutral-300); }
    .nav-lang-btn:hover { background-color: var(--ivs-neutral-700); border-color: var(--ivs-neutral-600); color: white; }

    /* Styling for Dropdown & Mega Menu Panels */
    .desktop-dropdown-content, .mega-menu-content {
        position: absolute;
        top: 100%;
        background-color: var(--ivs-neutral-800);
        border: 1px solid var(--ivs-neutral-700);
        border-radius: 0.5rem;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        opacity: 0;
        visibility: hidden;
        transform: translateY(10px) scale(0.95);
        transition: opacity 0.2s ease, transform 0.2s ease, visibility 0s linear 0.2s;
        z-index: 50;
        margin-top: 8px;
    }

    .group.dropdown-active .desktop-dropdown-content,
    .group.dropdown-active .mega-menu-content {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
        transition-delay: 0s;
    }

    .desktop-dropdown-content { width: 220px; right: 0; }
    .mega-menu-content { width: 480px; left: 50%; transform: translateX(-50%) translateY(10px) scale(0.95); }
    .group.dropdown-active .mega-menu-content { transform: translateX(-50%) translateY(0) scale(1); }

    .mega-menu-heading { font-size: 0.95rem; font-weight: 700; color: var(--ivs-secondary); padding: 4px 8px; margin-bottom: 8px; border-bottom: 1px solid var(--ivs-neutral-700); }
    
    /* Styling for items within dropdowns */
    .desktop-dropdown-item, .mega-menu-item { display: flex; align-items: center; width: 100%; padding: 10px 12px; font-size: 0.875rem; color: var(--ivs-neutral-300); transition: background-color 0.2s, color 0.2s; border-radius: 0.375rem; }
    .desktop-dropdown-item:hover, .mega-menu-item:hover { background-color: var(--ivs-neutral-700); color: white; }
    .mega-menu-icon { margin-right: 10px; width: 16px; color: var(--ivs-neutral-400); transition: color 0.2s; }
    .mega-menu-item:hover .mega-menu-icon { color: var(--ivs-secondary); }
    
    .lang-option-item { display: flex; align-items: center; width: 100%; text-align: left; padding: 10px 12px; font-size: 0.875rem; color: var(--ivs-neutral-300); border-radius: 0.375rem; transition: background-color 0.2s, color 0.2s; }
    .lang-option-item:hover { background-color: var(--ivs-neutral-700); color: white; }
    .lang-flag-icon { width: 20px; height: 12px; margin-right: 12px; object-fit: cover; border-radius: 2px; }

    /* Mobile Off-canvas Menu */
    .mobile-menu-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); z-index: 1001; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
    body.mobile-menu-active .mobile-menu-overlay { opacity: 1; visibility: visible; }
    
    .mobile-menu-panel { position: fixed; top: 0; left: -100%; width: 100%; max-width: 300px; height: 100%; background-color: var(--ivs-neutral-800); z-index: 1002; transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
    body.mobile-menu-active .mobile-menu-panel { left: 0; }
    
    .mobile-nav-link, .mobile-submenu-toggle { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 12px 16px; font-size: 1rem; font-weight: 500; color: var(--ivs-neutral-200); border-radius: 0.375rem; transition: background-color 0.2s, color 0.2s; }
    .mobile-nav-link:hover, .mobile-submenu-toggle:hover { background-color: var(--ivs-neutral-700); color: white; }
    
    .mobile-submenu-icon { transition: transform 0.3s ease; }
    .mobile-submenu-toggle[aria-expanded="true"] .mobile-submenu-icon { transform: rotate(180deg); }
    
    .mobile-submenu-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; padding-left: 16px; border-left: 2px solid var(--ivs-neutral-700); margin: 4px 0 8px 16px; }
    .mobile-submenu-content.active { max-height: 500px; }
    
    .mobile-submenu-item { display: block; padding: 8px 12px; font-size: 0.9rem; color: var(--ivs-neutral-300); border-radius: 0.375rem; transition: background-color 0.2s, color 0.2s; }
    .mobile-submenu-item:hover { background-color: var(--ivs-neutral-600); color: white; }
    .mobile-submenu-item.indent-1 { padding-left: 24px; }
    
    .lang-option-mobile { display: flex; align-items: center; width: 100%; text-align: left; padding: 8px 12px; color: var(--ivs-neutral-300); border-radius: 0.375rem; }
    .lang-option-mobile:hover { background-color: var(--ivs-neutral-600); color: white; }
    .lang-flag-icon-mobile { width: 20px; height: 12px; margin-right: 10px; border-radius: 2px; }

    /* Mobile Bottom Navigation Bar */
    #bottom-nav-bar { background: rgba(17, 24, 39, 0.95); backdrop-filter: blur(8px); border-top: 1px solid var(--ivs-neutral-700); box-shadow: 0 -4px 15px -3px rgba(0, 0, 0, 0.4); }
    .bottom-nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--ivs-neutral-400); padding: 4px 0; transition: color 0.3s; height: 100%; }
    .bottom-nav-item.active, .bottom-nav-item:hover { color: var(--ivs-secondary); }
    .bottom-nav-icon { font-size: 1.25rem; margin-bottom: 2px; }
    .bottom-nav-text { font-size: 0.65rem; font-weight: 500; }

    /* Desktop-specific adjustments */
    @media (min-width: 768px) {
        #main-header { height: var(--header-target-height-desktop); }
    }
</style>

<header id="main-header" role="banner" class="w-full shadow-lg fixed top-0 left-0 right-0 z-[1001]">
    <div class="container mx-auto px-3 sm:px-4 lg:px-6">
        <div class="flex items-center justify-between h-full">
            <!-- Logo Section -->
            <a href="/index.html" class="flex items-center space-x-2 group shrink-0" aria-label="IVS JSC Homepage" data-lang-key="aria_label_homepage_link">
                <img src="/images/logo/logo.png" alt="IVS JSC Logo" class="h-8 w-8 md:h-10 md:w-10 object-contain transition-transform duration-300 group-hover:scale-110"
                     loading="eager" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IiMwMDQwODAiLz48dGV4dCB4PSIyMCIgeT0iMjQiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPklWUzwvdGV4dD48L3N2Zz4='; this.alt='IVS Placeholder Logo';">
                <span class="text-xl md:text-2xl font-bold text-white group-hover:text-ivs-secondary transition-colors">
                    IVS <span class="text-ivs-secondary" data-lang-key="nav_jsc_short">JSC</span>
                </span>
            </a>

            <!-- Desktop Navigation -->
            <nav role="navigation" aria-label="Main desktop navigation" class="hidden md:flex items-center space-x-1 lg:space-x-1.5">
                <a href="/index.html" class="nav-link" data-lang-key="nav_home">Trang Chủ</a>
                <a href="/about.html" class="nav-link" data-lang-key="nav_about">Về IVS</a>

                <!-- Mega Menu for Services -->
                <div class="relative group" id="desktop-services-dropdown">
                    <button type="button" class="nav-link-dropdown" aria-haspopup="true" aria-expanded="false" aria-controls="services-mega-menu" data-lang-key="nav_services">
                        Dịch Vụ <i class="fas fa-chevron-down nav-link-icon"></i>
                    </button>
                    <div id="services-mega-menu" class="mega-menu-content" aria-labelledby="nav-services-button-desktop">
                        <div class="grid grid-cols-2 gap-x-6 gap-y-4 p-5">
                            <div>
                                <h3 class="mega-menu-heading" data-lang-key="nav_services_legal_consulting_main_title">Tư vấn Pháp lý</h3>
                                <ul class="space-y-1.5">
                                    <li><a href="/Pages/legal_consulting.html" class="mega-menu-item" data-lang-key="nav_services_legal_consulting_main_title_mobile"><i class="fas fa-gavel mega-menu-icon"></i>Tư vấn Pháp lý Chuyên sâu</a></li>
                                    <li><a href="/Pages/psb_introduction.html" class="mega-menu-item" data-lang-key="nav_services_corporate_law_psb"><i class="fas fa-balance-scale-right mega-menu-icon"></i>Pháp luật Doanh nghiệp & PSB</a></li>
                                    <li><a href="/Pages/litigation_consulting.html" class="mega-menu-item" data-lang-key="nav_services_civil_law"><i class="fas fa-users mega-menu-icon"></i>Pháp luật Dân sự & Tố tụng</a></li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="mega-menu-heading" data-lang-key="nav_services_education_title">Liên kết Giáo dục</h3>
                                <ul class="space-y-1.5">
                                    <li><a href="/consulting.html" class="mega-menu-item" data-lang-key="nav_education_main">Tổng quan Chương trình</a></li>
                                    <li><a href="/Pages/lkmamnon.html" class="mega-menu-item" data-lang-key="nav_education_preschool">Mầm non</a></li>
                                    <li><a href="/Pages/lktieuhoc.html" class="mega-menu-item" data-lang-key="nav_education_primary">Tiểu học</a></li>
                                    <li><a href="/Pages/lkthcsthpt.html" class="mega-menu-item" data-lang-key="nav_education_secondary">THCS & THPT</a></li>
                                    <li><a href="/Pages/lkttnn.html" class="mega-menu-item" data-lang-key="nav_education_language_center">Trung tâm Ngoại ngữ</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dropdown for Solutions -->
                <div class="relative group" id="desktop-solutions-dropdown">
                    <button type="button" class="nav-link-dropdown" aria-haspopup="true" aria-expanded="false" aria-controls="solutions-dropdown-menu" data-lang-key="nav_solutions">
                        Giải pháp <i class="fas fa-chevron-down nav-link-icon"></i>
                    </button>
                    <div id="solutions-dropdown-menu" class="desktop-dropdown-content" aria-labelledby="nav-solutions-button-desktop">
                        <ul class="space-y-px p-2">
                            <li><a href="/solutions.html" class="desktop-dropdown-item" data-lang-key="nav_solutions_main">Tổng quan</a></li>
                            <li><a href="/Pages/ivscelestech.html" class="desktop-dropdown-item" data-lang-key="nav_solution_edtech">Công nghệ Giáo dục</a></li>
                            <li><a href="/Pages/upskill.html" class="desktop-dropdown-item" data-lang-key="nav_solution_upskill">Nâng cao Trình độ</a></li>
                            <li><a href="/Pages/webdesign.html" class="desktop-dropdown-item" data-lang-key="nav_solution_webdesign">Thiết kế Website</a></li>
                        </ul>
                    </div>
                </div>
                
                <!-- Dropdown for Library -->
                <div class="relative group" id="desktop-library-dropdown">
                    <button type="button" class="nav-link-dropdown" aria-haspopup="true" aria-expanded="false" aria-controls="library-dropdown-menu" data-lang-key="nav_library">
                        Thư Viện <i class="fas fa-chevron-down nav-link-icon"></i>
                    </button>
                    <div id="library-dropdown-menu" class="desktop-dropdown-content" aria-labelledby="nav-library-button-desktop">
                        <ul class="space-y-px p-2">
                            <li><a href="/gallery.html" class="desktop-dropdown-item" data-lang-key="nav_library_main">Tổng quan</a></li>
                            <li><a href="/Pages/document-library.html" class="desktop-dropdown-item" data-lang-key="nav_library_docs">Tài liệu</a></li>
                            <li><a href="/apps/story-repository.html" class="desktop-dropdown-item" data-lang-key="nav_library_stories">Kho truyện</a></li>
                            <li><a href="/games/ivsgames.html" class="desktop-dropdown-item" data-lang-key="nav_library_games">IVS Games</a></li>
                            <li><a href="/apps/ivsapps.html" class="desktop-dropdown-item" data-lang-key="nav_library_apps">IVS Apps</a></li>
                            <li><a href="/apps/ivs-global-teacher-hub.html" class="desktop-dropdown-item" data-lang-key="nav_library_thub">IVS T-Hub</a></li>
                        </ul>
                    </div>
                </div>

                <a href="/news-archive.html" class="nav-link" data-lang-key="nav_news_archive">Tin tức</a>
                <a href="/contact.html" class="nav-contact-btn" data-lang-key="contact">Liên Hệ</a>

                <!-- Language Selector Dropdown -->
                <div class="relative group" id="desktop-language-dropdown">
                    <button type="button" class="nav-lang-btn" aria-haspopup="true" aria-expanded="false" aria-controls="language-dropdown-menu-desktop">
                        <i class="fas fa-globe mr-1.5 text-base"></i> <span id="current-lang-desktop">VI</span> <i class="fas fa-chevron-down nav-link-icon"></i>
                    </button>
                    <div id="language-dropdown-menu-desktop" class="desktop-dropdown-content min-w-[200px]" aria-labelledby="nav-language-button-desktop">
                        <ul class="space-y-px p-2">
                            <li><button data-lang="vi" class="lang-option-item w-full"><img src="/images/flags/vn.png" alt="Vietnamese Flag" class="lang-flag-icon" onerror="this.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';"> <span data-lang-key="lang_vi_long">Tiếng Việt (VI)</span></button></li>
                            <li><button data-lang="en" class="lang-option-item w-full"><img src="/images/flags/en.png" alt="English Flag" class="lang-flag-icon" onerror="this.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';"> <span data-lang-key="lang_en_long">English (EN)</span></button></li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Mobile Menu Toggle Button -->
            <button type="button" id="mobile-menu-button" class="md:hidden p-2 rounded-full hover:bg-ivs-neutral-700 transition-colors" aria-label="Mở menu" data-lang-key-aria="aria_label_open_mobile_menu">
                <i class="fas fa-bars text-xl" id="mobile-menu-open-icon"></i>
            </button>
        </div>
    </div>

    <!-- Mobile Off-canvas Menu Panel -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay"></div>
    <div id="mobile-menu-panel" class="mobile-menu-panel">
        <div class="flex items-center justify-between p-4 border-b border-ivs-neutral-700 sticky top-0 bg-ivs-neutral-800 z-10">
            <span class="text-lg font-semibold text-ivs-secondary" data-lang-key="mobile_menu_title">Menu</span>
            <button id="mobile-menu-close-btn" class="p-2 text-ivs-neutral-300 hover:text-ivs-secondary" aria-label="Đóng menu" data-lang-key-aria="aria_label_close_mobile_menu">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <nav role="navigation" aria-label="Main mobile navigation" class="flex-grow flex flex-col space-y-1 p-3 overflow-y-auto">
            <a href="/index.html" class="mobile-nav-link" data-lang-key="nav_home">Trang Chủ</a>
            <a href="/about.html" class="mobile-nav-link" data-lang-key="nav_about">Về IVS</a>
            
            <div>
                <button type="button" class="mobile-submenu-toggle" aria-expanded="false" aria-controls="mobile-services-submenu" data-lang-key="nav_services"><span>Dịch Vụ</span> <i class="fas fa-chevron-down mobile-submenu-icon"></i></button>
                <div id="mobile-services-submenu" class="mobile-submenu-content">
                    <a href="/Pages/legal_consulting.html" class="mobile-submenu-item" data-lang-key="nav_services_legal_consulting_main_title_mobile">Tư vấn Pháp lý</a>
                    <a href="/consulting.html" class="mobile-submenu-item" data-lang-key="nav_education_main">Liên kết Giáo dục</a>
                </div>
            </div>
            
            <a href="/news-archive.html" class="mobile-nav-link" data-lang-key="nav_news_archive">Tin tức</a>

            <div class="mt-auto pt-3 border-t border-ivs-neutral-700">
                 <button type="button" class="mobile-submenu-toggle" aria-expanded="false" aria-controls="mobile-language-submenu" data-lang-key="nav_languages_mobile_toggle">
                    <span class="flex items-center"><i class="fas fa-globe mr-2"></i><span data-lang-key="nav_languages">Ngôn ngữ</span></span> <i class="fas fa-chevron-down mobile-submenu-icon"></i>
                </button>
                 <div id="mobile-language-submenu" class="mobile-submenu-content">
                    <button data-lang="vi" class="lang-option-mobile w-full"><img src="/images/flags/vn.png" alt="Vietnamese Flag" class="lang-flag-icon-mobile" onerror="this.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';"> <span data-lang-key="lang_vi_long">Tiếng Việt (VI)</span></button>
                    <button data-lang="en" class="lang-option-mobile w-full"><img src="/images/flags/en.png" alt="English Flag" class="lang-flag-icon-mobile" onerror="this.src='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';"> <span data-lang-key="lang_en_long">English (EN)</span></button>
                </div>
                <a href="/contact.html" class="block w-full text-center px-3 py-3 mt-3 rounded-lg bg-ivs-accent hover:bg-orange-600 text-white font-semibold shadow-md" data-lang-key="contact">Liên Hệ</a>
            </div>
        </nav>
    </div>
    
    <!-- Bottom Navigation Bar (Mobile Only) -->
    <nav role="navigation" aria-label="Bottom mobile navigation" id="bottom-nav-bar" class="md:hidden fixed bottom-0 left-0 w-full grid grid-cols-5 h-16 z-[1000]">
        <a href="/index.html" class="bottom-nav-item" data-lang-key="bottom_nav_home" aria-label="Trang chủ" data-lang-key-aria="aria_label_home_bottom_nav"><i class="fas fa-home bottom-nav-icon"></i><span class="bottom-nav-text" data-lang-key="bottom_nav_home_short">Home</span></a>
        <a href="/solutions.html" class="bottom-nav-item" data-lang-key="bottom_nav_solutions" aria-label="Giải pháp" data-lang-key-aria="aria_label_solutions_bottom_nav"><i class="fas fa-tools bottom-nav-icon"></i><span class="bottom-nav-text" data-lang-key="bottom_nav_solutions_short">Giải pháp</span></a>
        <a href="/games/ivsgames.html" class="bottom-nav-item" data-lang-key="bottom_nav_games" aria-label="Trò chơi" data-lang-key-aria="aria_label_games_bottom_nav"><i class="fas fa-gamepad bottom-nav-icon"></i><span class="bottom-nav-text" data-lang-key="bottom_nav_games_short">Games</span></a>
        <a href="/apps/ivsapps.html" class="bottom-nav-item" data-lang-key="bottom_nav_apps" aria-label="Ứng dụng" data-lang-key-aria="aria_label_apps_bottom_nav"><i class="fas fa-shapes bottom-nav-icon"></i><span class="bottom-nav-text" data-lang-key="bottom_nav_apps_short">Apps</span></a>
        <button type="button" id="mobile-menu-bottom-toggle" class="bottom-nav-item" aria-label="Mở menu" data-lang-key-aria="aria_label_open_mobile_menu_bottom"><i class="fas fa-bars bottom-nav-icon"></i><span class="bottom-nav-text" data-lang-key="bottom_nav_menu_short">Menu</span></button>
    </nav>
</header>

<script>
    // This script should be placed right before the closing </body> tag
    // Or included in your main JavaScript bundle.
    document.addEventListener('DOMContentLoaded', () => {
        let activeDropdown = null;

        // Function to toggle desktop dropdowns
        const toggleDropdown = (button) => {
            const dropdown = button.closest('.group');
            if (!dropdown) return;

            // Close any other active dropdown
            if (activeDropdown && activeDropdown !== dropdown) {
                activeDropdown.classList.remove('dropdown-active');
                const prevButton = activeDropdown.querySelector('[aria-haspopup="true"]');
                if (prevButton) prevButton.setAttribute('aria-expanded', 'false');
            }

            // Toggle the current dropdown
            if (dropdown.classList.contains('dropdown-active')) {
                dropdown.classList.remove('dropdown-active');
                button.setAttribute('aria-expanded', 'false');
                activeDropdown = null;
            } else {
                dropdown.classList.add('dropdown-active');
                button.setAttribute('aria-expanded', 'true');
                activeDropdown = dropdown;
            }
        };

        // Attach event listeners to all desktop dropdown buttons
        document.querySelectorAll('#main-header nav .group > button').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent the document click from firing immediately
                toggleDropdown(button);
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (activeDropdown && !activeDropdown.contains(e.target)) {
                activeDropdown.classList.remove('dropdown-active');
                const button = activeDropdown.querySelector('[aria-haspopup="true"]');
                if (button) button.setAttribute('aria-expanded', 'false');
                activeDropdown = null;
            }
        });
        
        // Close dropdowns with the Escape key for accessibility
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && activeDropdown) {
                 activeDropdown.classList.remove('dropdown-active');
                 const button = activeDropdown.querySelector('[aria-haspopup="true"]');
                 if (button) button.setAttribute('aria-expanded', 'false');
                 activeDropdown = null;
            }
        });

        // --- Mobile Menu Logic ---
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenuCloseButton = document.getElementById('mobile-menu-close-btn');
        const mobileMenuBottomToggle = document.getElementById('mobile-menu-bottom-toggle');
        const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

        const openMobileMenu = () => {
            document.body.classList.add('mobile-menu-active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        };

        const closeMobileMenu = () => {
            document.body.classList.remove('mobile-menu-active');
            document.body.style.overflow = '';
        };

        // Event listeners for opening and closing the mobile menu
        [mobileMenuButton, mobileMenuBottomToggle].forEach(btn => {
            if (btn) btn.addEventListener('click', openMobileMenu);
        });
        [mobileMenuCloseButton, mobileMenuOverlay].forEach(btn => {
            if (btn) btn.addEventListener('click', closeMobileMenu);
        });

        // Logic for mobile submenus (accordion style)
        document.querySelectorAll('.mobile-submenu-toggle').forEach(button => {
            button.addEventListener('click', () => {
                const submenu = document.getElementById(button.getAttribute('aria-controls'));
                const isExpanded = button.getAttribute('aria-expanded') === 'true';
                
                // Close other submenus for a cleaner accordion effect
                document.querySelectorAll('.mobile-submenu-content.active').forEach(activeSubmenu => {
                    if (activeSubmenu !== submenu) {
                        activeSubmenu.classList.remove('active');
                        activeSubmenu.previousElementSibling.setAttribute('aria-expanded', 'false');
                    }
                });
                
                button.setAttribute('aria-expanded', !isExpanded);
                submenu.classList.toggle('active');
            });
        });
        
        // Function to highlight the active navigation link based on the current URL
        function updateActiveNav() {
            const currentPath = window.location.pathname.replace(/\/$/, ""); // Remove trailing slash

            // Update top navigation
            document.querySelectorAll('#main-header nav a.nav-link').forEach(link => {
                const linkPath = new URL(link.href).pathname.replace(/\/$/, "");
                if (linkPath === currentPath) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });

            // Update bottom navigation
             document.querySelectorAll('#bottom-nav-bar a').forEach(link => {
                 const linkPath = new URL(link.href).pathname.replace(/\/$/, "");
                if (linkPath === currentPath) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        }
        
        updateActiveNav();
    });
</script>
