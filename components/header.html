<header id="main-header" class="w-full bg-neutral-900 text-white shadow-sm nav-header sticky top-0 z-50">
    <div class="container mx-auto px-2 sm:px-3 lg:px-4">
        <div class="flex items-center justify-between min-h-full py-2"> 
            <a href="/index.html" class="flex items-center space-x-2 group" aria-label="IVS JSC Homepage">
                <img src="/images/logo/logo.png" alt="IVS JSC Logo" class="h-10 w-10 object-contain max-w-full max-h-full" onerror="this.onerror=null; this.src='https://placehold.co/40x40/cccccc/333333?text=L';">
                <span class="text-2xl font-bold group-hover:text-blue-400 transition-colors">
                    IVS <span class="text-secondary group-hover:text-emerald-400" data-translate="IVS Academy_JSC">JSC</span>
                </span>
            </a>

            <nav class="hidden md:flex space-x-2 lg:space-x-3 items-center" aria-label="Main desktop navigation">
                <a href="/index.html" class="hover:text-blue-400 transition-colors duration-300 font-medium px-3 py-2.5 rounded header-nav-text-custom" data-lang-key="nav_home">Trang Chủ</a>
                <a href="/about.html" class="hover:text-blue-400 transition-colors duration-300 font-medium px-3 py-2.5 rounded header-nav-text-custom" data-lang-key="nav_about">Về IVS</a>

                <div class="relative group mega-menu-container">
                    <button type="button" id="nav-services-button" aria-haspopup="true" aria-expanded="false" aria-controls="services-mega-menu" class="hover:text-blue-400 transition-colors duration-300 font-medium flex items-center px-3 py-2.5 rounded header-nav-text-custom" data-lang-key="nav_services">
                        Dịch Vụ <i class="fas fa-chevron-down header-icon-custom transform transition-transform duration-200 group-hover:rotate-180" aria-hidden="true"></i>
                    </button>
                    <div id="services-mega-menu" class="mega-menu absolute bg-neutral-800 text-white py-2 rounded-md shadow-lg z-20 min-w-[450px] origin-top-left" aria-labelledby="nav-services-button">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 px-2">
                            <div>
                                <h3 class="text-sm font-semibold mb-1 text-blue-400" data-lang-key="nav_services_education_title">Liên kết Giáo dục</h3>
                                <ul class="space-y-px">
                                    <li><a href="/consulting.html" class="block px-1 py-0.5 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_education_main">Tổng quan Chương trình Liên kết</a></li>
                                    <li><a href="/Pages/lkmamnon.html" class="block px-1 py-0.5 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_education_preschool">Mầm non</a></li>
                                    <li><a href="/Pages/lktieuhoc.html" class="block px-1 py-0.5 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_education_primary">Tiểu học</a></li>
                                    <li><a href="/Pages/lkthcsthpt.html" class="block px-1 py-0.5 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_education_secondary">THCS & THPT</a></li>
                                    <li><a href="/Pages/lkttnn.html" class="block px-1 py-0.5 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_education_language_center">Trung tâm Ngoại ngữ</a></li>
                                </ul>
                            </div>
                            <div>
                                <h3 class="text-sm font-semibold mb-1 text-emerald-400" data-lang-key="nav_services_business_title">Pháp luật Doanh nghiệp</h3>
                                <ul class="space-y-px">
                                    <li><a href="/Pages/psb_introduction.html" class="block px-1 py-0.5 hover:bg-neutral-700 hover:text-emerald-300 transition-colors rounded text-xs" data-lang-key="nav_psb_intro">Giới thiệu PSB</a></li>
                                    <li><a href="/Pages/legal_consulting.html" class="block px-1 py-0.5 hover:bg-neutral-700 hover:text-emerald-300 transition-colors rounded text-xs" data-lang-key="nav_psb_legal_consulting">Tư vấn Pháp lý Chuyên sâu</a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="px-2 pt-2 mt-2 border-t border-neutral-700">
                            <img src="/images/pages/ivs_solutions.jpeg" alt="IVS Solution Promotion" class="rounded shadow-md w-full max-h-[100px] object-cover" onerror="this.onerror=null; this.src='https://placehold.co/200x100/cccccc/ffffff?text=Img Err';">
                            <p class="text-xs text-neutral-400 mt-1" data-lang-key="nav_mega_promo">Khám phá các giải pháp toàn diện của IVS JSC!</p>
                        </div>
                    </div>
                </div>

                <div class="relative group">
                    <button type="button" id="nav-solutions-button" aria-haspopup="true" aria-expanded="false" aria-controls="solutions-dropdown-menu" class="hover:text-blue-400 transition-colors duration-300 font-medium flex items-center px-3 py-2.5 rounded header-nav-text-custom" data-lang-key="nav_solutions">
                        Giải pháp <i class="fas fa-chevron-down header-icon-custom transform transition-transform duration-200 group-hover:rotate-180" aria-hidden="true"></i>
                    </button>
                    <div id="solutions-dropdown-menu" class="desktop-dropdown-menu absolute bg-neutral-800 text-white py-1 rounded-md shadow-lg z-20 min-w-[180px] origin-top-left" aria-labelledby="nav-solutions-button">
                        <ul class="space-y-px">
                            <li><a href="/solutions.html" class="block px-2 py-1 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_solutions_main">Tổng quan Giải pháp</a></li>
                            <li><a href="/Pages/ivscelestech.html" class="block px-2 py-1 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_solution_edtech">Công nghệ Giáo dục</a></li>
                            <li><a href="/Pages/upskill.html" class="block px-2 py-1 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_solution_upskill">Nâng cao Trình độ</a></li>
                            <li><a href="/Pages/webdesign.html" class="block px-2 py-1 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_solution_webdesign">Thiết kế Website</a></li>
                        </ul>
                    </div>
                </div>

                <div class="relative group">
                    <button type="button" id="nav-library-button" aria-haspopup="true" aria-expanded="false" aria-controls="library-dropdown-menu" class="hover:text-blue-400 transition-colors duration-300 font-medium flex items-center px-3 py-2.5 rounded header-nav-text-custom" data-lang-key="nav_library">
                        Thư Viện <i class="fas fa-chevron-down header-icon-custom transform transition-transform duration-200 group-hover:rotate-180" aria-hidden="true"></i>
                    </button>
                    <div id="library-dropdown-menu" class="desktop-dropdown-menu absolute bg-neutral-800 text-white py-1 rounded-md shadow-lg z-20 min-w-[180px] origin-top-left" aria-labelledby="nav-library-button">
                        <ul class="space-y-px">
                            <li><a href="/gallery.html" class="block px-2 py-1 hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_library_main">Tổng quan Thư viện</a></li>
                            <li><a href="/Pages/document-library.html" class="block px-2 py-1 rounded hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_library_docs">Tài liệu Giáo dục</a></li>
                            <li><a href="/Pages/story-repository.html" class="block px-2 py-1 rounded hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-xs" data-lang-key="nav_library_stories">Kho truyện</a></li>
                        </ul>
                    </div>
                </div>

                <a href="/news-archive.html" class="hover:text-blue-400 transition-colors duration-300 font-medium px-3 py-2.5 rounded header-nav-text-custom" data-lang-key="nav_news_archive">Tin tức</a>
                <a href="/contact.html" class="bg-secondary hover:bg-emerald-600 text-white px-4 py-2.5 rounded-md font-semibold transition-colors duration-300 shadow-sm hover:shadow-md header-nav-text-custom" data-lang-key="nav_contact">Liên Hệ</a>

                <div id="language-toggle-container" class="flex border border-neutral-700 rounded">
                    <button id="lang-vi" data-lang="vi" class="lang-button px-3.5 py-2 text-base font-semibold focus:outline-none rounded-l text-white hover:bg-neutral-700" data-lang-key="lang_vi_short" aria-pressed="true">VI</button>
                    <button id="lang-en" data-lang="en" class="lang-button px-3.5 py-2 text-base font-semibold focus:outline-none rounded-r border-l border-neutral-700 text-neutral-400 hover:bg-neutral-700 hover:text-white" data-lang-key="lang_en_short" aria-pressed="false">EN</button>
                </div>
            </nav>

            <div class="flex items-center space-x-2 md:hidden relative z-[51]">
                <div id="language-toggle-container-mobile-top" class="flex border border-neutral-700 rounded">
                    <button data-lang="vi" class="lang-button px-2.5 py-1.5 text-sm font-semibold focus:outline-none rounded-l text-white hover:bg-neutral-700" data-lang-key="lang_vi_short" aria-pressed="true">VI</button>
                    <button data-lang="en" class="lang-button px-2.5 py-1.5 text-sm font-semibold focus:outline-none rounded-r border-l border-neutral-700 text-neutral-400 hover:bg-neutral-700 hover:text-white" data-lang-key="lang_en_short" aria-pressed="false">EN</button>
                </div>

                <button type="button" id="mobile-menu-button" aria-expanded="false" aria-controls="mobile-menu-panel" class="text-white focus:outline-none" aria-label="Open main menu">
                    <span class="sr-only">Open main menu</span>
                    <span class="relative flex items-center justify-center w-8 h-8">
                        <i class="fas fa-bars icon-menu-bar text-2xl" id="icon-menu-open"></i>
                        <i class="fas fa-times icon-menu-close-bar text-2xl" id="icon-menu-close"></i>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <div id="mobile-menu-panel" class="md:hidden fixed w-full h-full z-[60] top-0 left-0 right-0 hidden">
        <div class="mobile-menu-container bg-neutral-900 absolute top-0 right-0 h-full w-[85%] max-w-xs shadow-xl">
            <nav class="flex flex-col space-y-0.5 px-3 pt-10 pb-16 h-full overflow-y-auto" aria-label="Main mobile navigation">
                <a href="/index.html" class="block px-2 py-2.5 rounded hover:bg-neutral-800 hover:text-blue-400 font-medium transition-colors text-sm" data-lang-key="nav_home">Trang Chủ</a>
                <a href="/about.html" class="block px-2 py-2.5 rounded hover:bg-neutral-800 hover:text-blue-400 font-medium transition-colors text-sm" data-lang-key="nav_about">Về IVS</a>

                <div>
                    <button type="button" class="mobile-submenu-toggle w-full text-left px-2 py-2.5 rounded hover:bg-neutral-800 font-semibold text-blue-400 flex justify-between items-center transition-colors text-sm" aria-expanded="false" aria-controls="mobile-services-submenu-items" data-lang-key="nav_services">
                        <span>Dịch Vụ</span>
                        <i class="fas fa-chevron-down fa-xs mobile-submenu-icon transition-transform duration-200" aria-hidden="true"></i>
                    </button>
                    <div id="mobile-services-submenu-items" class="mobile-submenu-content pl-3 pr-1 pb-0.5 space-y-0.5 overflow-hidden max-h-0 transition-all duration-300 ease-in-out">
                        <a href="/consulting.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_services_main">Tổng quan Dịch vụ</a>
                        <a href="/education.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_education_main">Chương trình Giáo dục</a>
                        <a href="/Pages/lkmamnon.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_education_preschool">Mầm non</a>
                        <a href="/Pages/lktieuhoc.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_education_primary">Tiểu học</a>
                        <a href="/Pages/lkthcsthpt.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_education_secondary">THCS & THPT</a>
                        <a href="/Pages/lkttnn.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_education_language_center">Trung tâm Ngoại ngữ</a>
                        <a href="/Pages/psb_introduction.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-emerald-300 text-sm font-medium transition-colors" data-lang-key="nav_psb_intro">Giới thiệu PSB</a>
                        <a href="/Pages/legal_consulting.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-emerald-300 text-sm font-medium transition-colors" data-lang-key="nav_psb_legal_consulting">Tư vấn Pháp lý Chuyên sâu</a>
                    </div>
                </div>

                <div>
                    <button type="button" class="mobile-submenu-toggle w-full text-left px-2 py-2.5 rounded hover:bg-neutral-800 font-semibold text-blue-400 flex justify-between items-center transition-colors text-sm" aria-expanded="false" aria-controls="mobile-solutions-submenu-items" data-lang-key="nav_solutions">
                        <span>Giải pháp</span>
                        <i class="fas fa-chevron-down fa-xs mobile-submenu-icon transition-transform duration-200" aria-hidden="true"></i>
                    </button>
                    <div id="mobile-solutions-submenu-items" class="mobile-submenu-content pl-3 pr-1 pb-0.5 space-y-0.5 overflow-hidden max-h-0 transition-all duration-300 ease-in-out">
                        <a href="/solutions.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_solutions_main">Tổng quan Giải pháp</a>
                        <a href="/Pages/ivscelestech.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_solution_edtech">Công nghệ Giáo dục</a>
                        <a href="/Pages/upskill.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_solution_upskill">Nâng cao Trình độ</a>
                        <a href="/Pages/webdesign.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 transition-colors rounded text-sm" data-lang-key="nav_solution_webdesign">Thiết kế Website</a>
                    </div>
                </div>

                <div>
                    <button type="button" class="mobile-submenu-toggle w-full text-left px-2 py-2.5 rounded hover:bg-neutral-800 font-semibold text-blue-400 flex justify-between items-center transition-colors text-sm" aria-expanded="false" aria-controls="mobile-library-submenu-items" data-lang-key="nav_library">
                        <span>Thư Viện</span>
                        <i class="fas fa-chevron-down fa-xs mobile-submenu-icon transition-transform duration-200" aria-hidden="true"></i>
                    </button>
                    <div id="mobile-library-submenu-items" class="mobile-submenu-content pl-3 pr-1 pb-0.5 space-y-0.5 overflow-hidden max-h-0 transition-all duration-300 ease-in-out">
                        <a href="/gallery.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_library_main">Tổng quan Thư viện</a>
                        <a href="/Pages/document-library.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_library_docs">Tài liệu Giáo dục</a>
                        <a href="/Pages/story-repository.html" class="block px-3 py-2 rounded hover:bg-neutral-700 hover:text-blue-300 text-sm font-medium transition-colors" data-lang-key="nav_library_stories">Kho truyện</a>
                    </div>
                </div>

                <a href="/news-archive.html" class="block px-2 py-2.5 rounded hover:bg-neutral-800 hover:text-blue-400 font-medium transition-colors text-sm" data-lang-key="nav_news_archive">Tin tức</a>
                <a href="/contact.html" class="block px-2 py-2.5 rounded bg-secondary text-white hover:bg-emerald-600 font-semibold text-center transition-colors shadow-sm hover:shadow-md text-sm" data-lang-key="nav_contact">Liên Hệ</a>
                
                <div id="language-toggle-container-mobile-panel" class="flex border border-neutral-700 rounded mx-auto mt-3 w-max">
                    <button data-lang="vi" class="lang-button px-3 py-2 text-sm font-semibold focus:outline-none rounded-l text-white hover:bg-neutral-700" data-lang-key="lang_vi_short" aria-pressed="true">VI</button>
                    <button data-lang="en" class="lang-button px-3 py-2 text-sm font-semibold focus:outline-none rounded-r border-l border-neutral-700 text-neutral-400 hover:bg-neutral-700 hover:text-white" data-lang-key="lang_en_short" aria-pressed="false">EN</button>
                </div>
            </nav>
        </div>
        <div id="mobile-menu-backdrop" class="absolute inset-0 bg-black/70 -z-10"></div>
    </div>
    <div class="bottom-nav md:hidden fixed bottom-0 left-0 w-full bg-neutral-800 shadow-t z-30">
        <div class="flex justify-around items-center h-12">
            <a href="/index.html" class="bottom-nav-item text-neutral-400 hover:text-white p-2" data-lang-key="bottom_nav_home" aria-label="Trang chủ">
                <i class="fas fa-home text-xl"></i>
            </a>
            <a href="/solutions.html" class="bottom-nav-item text-neutral-400 hover:text-white p-2" data-lang-key="bottom_nav_solutions" aria-label="Giải pháp">
                <i class="fas fa-tools text-xl"></i>
            </a>
            <a href="/news-archive.html" class="bottom-nav-item text-neutral-400 hover:text-white p-2" data-lang-key="bottom_nav_news" aria-label="Tin tức">
                <i class="fas fa-newspaper text-xl"></i>
            </a>
            <a href="/consulting.html" class="bottom-nav-item text-neutral-400 hover:text-white p-2" data-lang-key="bottom_nav_services" aria-label="Dịch vụ">
                <i class="fas fa-concierge-bell text-xl"></i> </a>
            <a href="/gallery.html" class="bottom-nav-item text-neutral-400 hover:text-white p-2" data-lang-key="bottom_nav_library" aria-label="Thư viện">
                <i class="fas fa-book-open text-xl"></i> </a>
        </div>
    </div>
</header>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenuPanel = document.getElementById('mobile-menu-panel');
    const mobileMenuContainer = mobileMenuPanel ? mobileMenuPanel.querySelector('.mobile-menu-container') : null;
    const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
    const iconOpen = document.getElementById('icon-menu-open');
    const iconClose = document.getElementById('icon-menu-close');

    if (mobileMenuButton && mobileMenuPanel && mobileMenuContainer && iconOpen && iconClose && mobileMenuBackdrop) {
        iconClose.style.display = 'none';
        mobileMenuContainer.style.transition = 'transform 0.3s ease-in-out';
        mobileMenuContainer.style.transform = 'translateX(100%)';

        const openMenu = () => {
            mobileMenuPanel.classList.remove('hidden');
            setTimeout(() => {
                 mobileMenuContainer.style.transform = 'translateX(0%)';
            }, 10); 

            iconOpen.style.display = 'none';
            iconClose.style.display = 'inline-block';
            document.body.style.overflow = 'hidden';
            mobileMenuButton.setAttribute('aria-expanded', 'true');
        };

        const closeMenu = () => {
            mobileMenuContainer.style.transform = 'translateX(100%)';
            setTimeout(() => {
                mobileMenuPanel.classList.add('hidden');
            }, 300);

            iconOpen.style.display = 'inline-block';
            iconClose.style.display = 'none';
            document.body.style.overflow = '';
            mobileMenuButton.setAttribute('aria-expanded', 'false');
        };

        mobileMenuButton.addEventListener('click', () => {
            const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
            if (isExpanded) {
                closeMenu();
            } else {
                openMenu();
            }
        });
        mobileMenuBackdrop.addEventListener('click', closeMenu);
    }

    const mobileSubmenuToggles = document.querySelectorAll('.mobile-submenu-toggle');
    mobileSubmenuToggles.forEach(toggle => {
        toggle.addEventListener('click', () => {
            const content = document.getElementById(toggle.getAttribute('aria-controls'));
            const icon = toggle.querySelector('.mobile-submenu-icon');
            const isExpanded = toggle.getAttribute('aria-expanded') === 'true';

            if (content) {
                if (isExpanded) {
                    content.style.maxHeight = '0px';
                } else {
                    content.style.maxHeight = content.scrollHeight + 'px';
                }
            }
            if (icon) {
                icon.classList.toggle('rotate-180', !isExpanded);
            }
            toggle.setAttribute('aria-expanded', String(!isExpanded));
        });
    });

    const desktopDropdownButtons = [
        document.getElementById('nav-services-button'),
        document.getElementById('nav-solutions-button'),
        document.getElementById('nav-library-button')
    ].filter(Boolean);

    desktopDropdownButtons.forEach(button => {
        const menu = document.getElementById(button.getAttribute('aria-controls'));
        if (menu) {
            menu.style.display = 'none';
            menu.classList.add('opacity-0', 'transition-opacity', 'duration-200', 'ease-in-out');

            button.addEventListener('click', (event) => {
                event.stopPropagation();
                const isExpanded = button.getAttribute('aria-expanded') === 'true';

                desktopDropdownButtons.forEach(otherButton => {
                    if (otherButton !== button) {
                        const otherMenu = document.getElementById(otherButton.getAttribute('aria-controls'));
                        if (otherMenu) {
                            otherMenu.style.display = 'none';
                            otherMenu.classList.add('opacity-0');
                            otherButton.setAttribute('aria-expanded', 'false');
                            const otherIcon = otherButton.querySelector('.header-icon-custom');
                            if (otherIcon) otherIcon.classList.remove('rotate-180');
                        }
                    }
                });

                if (isExpanded) {
                    menu.classList.add('opacity-0');
                    setTimeout(() => menu.style.display = 'none', 200);
                } else {
                    menu.style.display = 'block';
                    setTimeout(() => menu.classList.remove('opacity-0'), 10);
                }
                button.setAttribute('aria-expanded', String(!isExpanded));
                const icon = button.querySelector('.header-icon-custom');
                if (icon) icon.classList.toggle('rotate-180', !isExpanded);
            });
        }
    });

    document.addEventListener('click', (event) => {
        desktopDropdownButtons.forEach(button => {
            const menu = document.getElementById(button.getAttribute('aria-controls'));
            if (menu && button.getAttribute('aria-expanded') === 'true' && !button.contains(event.target) && !menu.contains(event.target)) {
                menu.classList.add('opacity-0');
                setTimeout(() => menu.style.display = 'none', 200);
                button.setAttribute('aria-expanded', 'false');
                const icon = button.querySelector('.header-icon-custom');
                if (icon) icon.classList.remove('rotate-180');
            }
        });
    });

    const allLangButtons = document.querySelectorAll('.lang-button');
    const currentLangKey = 'current_language_ivs_jsc_v2'; 

    function setActiveLangButtonStates(lang) {
        allLangButtons.forEach(btn => {
            if (btn.dataset.lang === lang) {
                btn.setAttribute('aria-pressed', 'true');
                btn.classList.remove('text-neutral-400');
                btn.classList.add('text-white', 'bg-neutral-700');
            } else {
                btn.setAttribute('aria-pressed', 'false');
                btn.classList.remove('text-white', 'bg-neutral-700');
                btn.classList.add('text-neutral-400');
            }
        });
    }
    
    const savedLang = localStorage.getItem(currentLangKey) || 'vi';
    setActiveLangButtonStates(savedLang);
    if (typeof window.updateLanguageContent === 'function') {
         window.updateLanguageContent(savedLang, true);
    }


    allLangButtons.forEach(button => {
        button.addEventListener('click', function() {
            const lang = this.dataset.lang;
            localStorage.setItem(currentLangKey, lang);
            setActiveLangButtonStates(lang);

            if (typeof window.updateLanguageContent === 'function') {
                window.updateLanguageContent(lang);
            } else {
                console.warn('window.updateLanguageContent function not found. Page will reload for language change.');
                location.reload();
            }
        });
    });

    const bottomNavItems = document.querySelectorAll('.bottom-nav-item');
    const currentPath = window.location.pathname;
    const activeBottomNavClass = 'text-white'; 
    const inactiveBottomNavClass = 'text-neutral-400';

    bottomNavItems.forEach(item => {
        const itemHref = item.getAttribute('href');
        let isMatch = false;
        if (currentPath === itemHref || (currentPath === '/' && itemHref === '/index.html') || (currentPath === '' && itemHref === '/index.html') ) {
            isMatch = true;
        } else if (itemHref !== '/index.html' && itemHref !== '/' && currentPath.startsWith(itemHref) && itemHref.length > 1) {
             // Check if currentPath is exactly itemHref or itemHref + trailing slash or itemHref + /index.html
            if (currentPath === itemHref || currentPath === itemHref + '/' || currentPath === itemHref + '/index.html') {
                isMatch = true;
            }
        }


        if (isMatch) {
            item.classList.add(activeBottomNavClass);
            item.classList.remove(inactiveBottomNavClass);
        } else {
            item.classList.add(inactiveBottomNavClass);
            item.classList.remove(activeBottomNavClass);
        }
    });
});
</script>
