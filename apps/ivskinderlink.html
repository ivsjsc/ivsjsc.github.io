<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Tr∆∞·ªùng M·∫ßm Non</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Screen Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            animation: fadeIn 0.5s ease-in-out;
        }

        .login-box h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-box p {
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            text-align: left;
        }

        .login-form input,
        .login-form select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .login-form input:focus,
        .login-form select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        #loginError {
            color: #e74c3c;
            margin-top: 15px;
            font-weight: 600;
            display: none;
        }

        /* Main App Styles */
        .app-container {
            display: none;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 5px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-left p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(102, 126, 234, 0.1);
            padding: 15px 20px;
            border-radius: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .user-details h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .user-role {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .logout-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #ee5a24;
            transform: translateY(-1px);
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-tab {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s ease;
            text-align: center;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .nav-tab:hover:not(.active) {
            background: #f0f2f5;
        }
        
        .nav-tab.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #e9ecef !important;
            color: #adb5bd !important;
            box-shadow: none !important;
            transform: none !important;
        }

        .tab-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-title {
            color: #2c3e50; 
            margin-bottom: 25px; 
            font-size: 2em;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .permission-notice {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.2);
        }
        
        .form-group textarea {
            resize: vertical;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
            vertical-align: middle;
        }

        .data-table th {
            background: #f8f9fa;
            color: #343a40;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }

        .data-table tr:hover {
            background: #f1f3f5;
        }

        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .camera-feed {
            background: #000;
            border-radius: 15px;
            position: relative;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .camera-feed img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-label {
            position: absolute;
            top: 15px;
            left: 20px;
            background: rgba(102, 126, 234, 0.9);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0, 0.05);
            border-left: 5px solid #667eea;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 1.1em;
            color: #7f8c8d;
        }

        .success-message {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .placeholder-content {
            text-align: center;
            padding: 50px 20px;
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .placeholder-content .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            .nav-tabs {
                flex-direction: column;
            }
            .header {
                flex-direction: column;
                text-align: center;
            }
            .header-left h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1>üåü ƒêƒÉng Nh·∫≠p</h1>
            <p>Tr∆∞·ªùng M·∫ßm Non H·∫°nh Ph√∫c</p>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">üë§ T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="username" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
                </div>
                <div class="form-group">
                    <label for="password">üîí M·∫≠t kh·∫©u</label>
                    <input type="password" id="password" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
                <div class="form-group">
                    <label for="userRole">üë• Vai tr√≤</label>
                    <select id="userRole" required>
                        <option value="">Ch·ªçn vai tr√≤</option>
                        <option value="principal">üë®‚Äçüíº Hi·ªáu tr∆∞·ªüng</option>
                        <option value="teacher">üë©‚Äçüè´ Gi√°o vi√™n</option>
                        <option value="parent">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Ph·ª• huynh</option>
                    </select>
                </div>
                <button type="submit" class="login-btn">üöÄ ƒêƒÉng Nh·∫≠p</button>
                <p id="loginError">T√™n ƒëƒÉng nh·∫≠p, m·∫≠t kh·∫©u ho·∫∑c vai tr√≤ kh√¥ng ƒë√∫ng.</p>
            </form>
            <div style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; font-size: 14px; text-align: left;">
                <strong>T√†i kho·∫£n Demo:</strong><br>
                <small>
                    ‚Ä¢ Hi·ªáu tr∆∞·ªüng: <b>admin</b> / <b>admin123</b><br>
                    ‚Ä¢ Gi√°o vi√™n: <b>teacher</b> / <b>teacher123</b><br>
                    ‚Ä¢ Ph·ª• huynh: <b>parent</b> / <b>parent123</b>
                </small>
            </div>
        </div>
    </div>

    <div id="mainApp" class="container app-container">
        <header class="header">
            <div class="header-left">
                <h1>H·ªá Th·ªëng Qu·∫£n L√Ω Tr∆∞·ªùng M·∫ßm Non</h1>
                <p>Qu·∫£n l√Ω th√¥ng tin hi·ªáu qu·∫£ v√† k·∫øt n·ªëi gia ƒë√¨nh</p>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div class="user-details">
                    <h3 id="currentUserName">Admin</h3>
                    <span class="user-role" id="currentUserRole">Hi·ªáu tr∆∞·ªüng</span>
                </div>
                <button class="logout-btn" onclick="logout()">üö™ ƒêƒÉng xu·∫•t</button>
            </div>
        </header>

        <div class="nav-tabs" id="navTabs">
            <button data-tab="dashboard" class="nav-tab active" onclick="showTab('dashboard')">üìä T·ªïng Quan</button>
            <button data-tab="children" class="nav-tab" onclick="showTab('children')">üë∂ Qu·∫£n L√Ω Tr·∫ª</button>
            <button data-tab="parents" class="nav-tab" onclick="showTab('parents')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Ph·ª• Huynh</button>
            <button data-tab="camera" class="nav-tab" onclick="showTab('camera')">üìπ Camera</button>
            <button data-tab="facebook" class="nav-tab" onclick="showTab('facebook')">üìò Facebook</button>
            <button data-tab="users" class="nav-tab" onclick="showTab('users')">üë• Qu·∫£n L√Ω User</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <h2 class="tab-title">üìä T·ªïng Quan Ho·∫°t ƒê·ªông</h2>
            <div class="stats-grid">
                 <div class="stat-card">
                    <div class="stat-number" id="totalChildren">0</div>
                    <div class="stat-label">T·ªïng s·ªë tr·∫ª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalParents">0</div>
                    <div class="stat-label">Ph·ª• huynh</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeCameras">0</div>
                    <div class="stat-label">Camera ho·∫°t ƒë·ªông</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">24</div>
                    <div class="stat-label">B√†i ƒëƒÉng FB h√¥m nay</div>
                </div>
            </div>
        </div>

        <div id="children" class="tab-content">
            <h2 class="tab-title">üë∂ Qu·∫£n L√Ω Th√¥ng Tin Tr·∫ª Em</h2>
            <div class="permission-notice" id="childrenPermissionNotice" style="display: none;"></div>
            <div class="success-message" id="childSuccessMessage"></div>
            <div id="childFormContainer">
                <form id="childForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="childName">H·ªç v√† t√™n tr·∫ª</label>
                            <input type="text" id="childName" required placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß">
                        </div>
                        <div class="form-group">
                            <label for="childBirthDate">Ng√†y sinh</label>
                            <input type="date" id="childBirthDate" required>
                        </div>
                        <div class="form-group">
                            <label for="childGender">Gi·ªõi t√≠nh</label>
                            <select id="childGender" required><option value="">Ch·ªçn gi·ªõi t√≠nh</option><option value="Nam">Nam</option><option value="N·ªØ">N·ªØ</option></select>
                        </div>
                        <div class="form-group">
                            <label for="childClass">L·ªõp h·ªçc</label>
                            <select id="childClass" required><option value="">Ch·ªçn l·ªõp</option><option value="L·ªõp Ch·ªìi">L·ªõp Ch·ªìi</option><option value="L·ªõp L√°">L·ªõp L√°</option></select>
                        </div>
                        <div class="form-group">
                            <label for="childAddress">ƒê·ªãa ch·ªâ</label>
                            <input type="text" id="childAddress" required placeholder="ƒê·ªãa ch·ªâ n∆°i ·ªü">
                        </div>
                        <div class="form-group">
                            <label for="childHealth">T√¨nh tr·∫°ng s·ª©c kh·ªèe</label>
                            <textarea id="childHealth" rows="3" placeholder="Ghi ch√∫ v·ªÅ s·ª©c kh·ªèe, d·ªã ·ª©ng..."></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ L∆∞u Th√¥ng Tin Tr·∫ª</button>
                </form>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead><tr><th>H·ªç t√™n</th><th>Ng√†y sinh</th><th>Gi·ªõi t√≠nh</th><th>L·ªõp</th><th>ƒê·ªãa ch·ªâ</th><th>Thao t√°c</th></tr></thead>
                    <tbody id="childrenTableBody"></tbody>
                </table>
            </div>
        </div>
        
        <div id="parents" class="tab-content">
            <h2 class="tab-title">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Qu·∫£n L√Ω Th√¥ng Tin Ph·ª• Huynh</h2>
            <div class="permission-notice" id="parentsPermissionNotice" style="display: none;"></div>
            <div class="success-message" id="parentSuccessMessage"></div>
            <div id="parentFormContainer">
                 <form id="parentForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fatherName">H·ªç t√™n cha</label> <input type="text" id="fatherName" placeholder="H·ªç t√™n cha">
                        </div>
                        <div class="form-group">
                            <label for="motherName">H·ªç t√™n m·∫π</label> <input type="text" id="motherName" placeholder="H·ªç t√™n m·∫π">
                        </div>
                        <div class="form-group">
                             <label for="fatherPhone">S·ªë ƒëi·ªán tho·∫°i cha</label> <input type="tel" id="fatherPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i cha">
                        </div>
                         <div class="form-group">
                             <label for="motherPhone">S·ªë ƒëi·ªán tho·∫°i m·∫π</label> <input type="tel" id="motherPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i m·∫π">
                        </div>
                        <div class="form-group">
                            <label for="parentEmail">Email li√™n h·ªá</label> <input type="email" id="parentEmail" placeholder="Email ƒë·ªÉ li√™n h·ªá">
                        </div>
                        <div class="form-group">
                            <label for="relatedChild">Tr·∫ª li√™n quan</label>
                            <select id="relatedChild" required><option value="">Ch·ªçn tr·∫ª</option></select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ L∆∞u Th√¥ng Tin Ph·ª• Huynh</button>
                </form>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead><tr><th>T√™n cha</th><th>T√™n m·∫π</th><th>SƒêT cha</th><th>SƒêT m·∫π</th><th>Email</th><th>Tr·∫ª</th><th>Thao t√°c</th></tr></thead>
                    <tbody id="parentsTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="camera" class="tab-content">
            <h2 class="tab-title">üìπ H·ªá Th·ªëng Camera Gi√°m S√°t</h2>
            <div class="permission-notice" id="cameraPermissionNotice" style="display: none;"></div>
            <div class="camera-grid" id="cameraGrid"></div>
        </div>

        <div id="facebook" class="tab-content">
             <h2 class="tab-title">üìò B·∫£ng Tin Facebook</h2>
             <div class="placeholder-content">
                <div class="icon">üëç</div>
                <p>Khu v·ª±c hi·ªÉn th·ªã c√°c b√†i ƒëƒÉng m·ªõi nh·∫•t t·ª´ trang Facebook c·ªßa tr∆∞·ªùng.</p>
                <p>T√≠nh nƒÉng ƒëang trong giai ƒëo·∫°n ph√°t tri·ªÉn.</p>
             </div>
        </div>

        <div id="users" class="tab-content">
            <h2 class="tab-title">üë• Qu·∫£n L√Ω Ng∆∞·ªùi D√πng</h2>
            <div class="placeholder-content">
                <div class="icon">üõ†Ô∏è</div>
                <p>Khu v·ª±c d√†nh cho Hi·ªáu tr∆∞·ªüng ƒë·ªÉ qu·∫£n l√Ω t√†i kho·∫£n gi√°o vi√™n v√† ph·ª• huynh.</p>
                <p>T√≠nh nƒÉng ƒëang trong giai ƒëo·∫°n ph√°t tri·ªÉn.</p>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const db = {
        users: [
            { id: 1, username: 'admin', password: 'admin123', role: 'principal', name: 'BGH', assignedClass: null, childId: null },
            { id: 2, username: 'teacher', password: 'teacher123', role: 'teacher', name: 'C√¥ Mai', assignedClass: 'L·ªõp Ch·ªìi', childId: null },
            { id: 3, username: 'parent', password: 'parent123', role: 'parent', name: 'Anh Khoa', assignedClass: null, childId: 101 }
        ],
        children: [
            { id: 101, name: 'Nguy·ªÖn An Nhi√™n', birthDate: '2022-05-20', gender: 'N·ªØ', class: 'L·ªõp Ch·ªìi', address: '123 ƒê∆∞·ªùng ABC, Q1, TPHCM', health: 'B√¨nh th∆∞·ªùng' },
            { id: 102, name: 'Tr·∫ßn Minh Khang', birthDate: '2022-03-15', gender: 'Nam', class: 'L·ªõp Ch·ªìi', address: '456 ƒê∆∞·ªùng XYZ, Q2, TPHCM', health: 'D·ªã ·ª©ng s·ªØa' },
            { id: 103, name: 'L√™ Th·∫£o Vy', birthDate: '2021-08-10', gender: 'N·ªØ', class: 'L·ªõp L√°', address: '789 ƒê∆∞·ªùng KLM, Q3, TPHCM', health: 'B√¨nh th∆∞·ªùng' }
        ],
        parents: [
            { id: 201, fatherName: 'Nguy·ªÖn VƒÉn Khoa', motherName: 'ƒê·∫∑ng Th·ªã B√≠ch', fatherPhone: '0901234567', motherPhone: '0908765432', email: 'khoa.nv@email.com', childId: 101 },
            { id: 202, fatherName: 'Tr·∫ßn VƒÉn An', motherName: 'L√Ω Th·ªã B√¨nh', fatherPhone: '0912345678', motherPhone: '0918765432', email: 'an.tv@email.com', childId: 102 }
        ],
        cameras: [
            { id: 301, name: 'S√¢n ch∆°i', class: 'Chung', url: 'https://placehold.co/600x400/000000/FFFFFF?text=S√¢n+Ch∆°i' },
            { id: 302, name: 'L·ªõp Ch·ªìi - G√≥c h·ªçc t·∫≠p', class: 'L·ªõp Ch·ªìi', url: 'https://placehold.co/600x400/000000/FFFFFF?text=L·ªõp+Ch·ªìi' },
            { id: 303, name: 'L·ªõp L√° - Gi·ªù ƒÉn', class: 'L·ªõp L√°', url: 'https://placehold.co/600x400/000000/FFFFFF?text=L·ªõp+L√°' }
        ]
    };

    let currentUser = null;

    const loginScreen = document.getElementById('loginScreen');
    const mainApp = document.getElementById('mainApp');
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');

    const handleLogin = (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const role = document.getElementById('userRole').value;

        const foundUser = db.users.find(user => 
            user.username === username && user.password === password && user.role === role
        );

        if (foundUser) {
            currentUser = foundUser;
            loginScreen.style.display = 'none';
            mainApp.style.display = 'block';
            loginError.style.display = 'none';
            loginForm.reset();
            initializeApp();
        } else {
            loginError.style.display = 'block';
        }
    };

    const initializeApp = () => {
        updateUserInfo();
        setupPermissions();
        renderAll();
        showTab('dashboard');
    };

    const updateUserInfo = () => {
        document.getElementById('currentUserName').textContent = currentUser.name;
        document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
        
        const roleNames = { principal: 'Hi·ªáu tr∆∞·ªüng', teacher: 'Gi√°o vi√™n', parent: 'Ph·ª• huynh' };
        document.getElementById('currentUserRole').textContent = roleNames[currentUser.role];
    };
    
    const setupPermissions = () => {
        const allTabs = document.querySelectorAll('.nav-tab');
        allTabs.forEach(tab => tab.classList.remove('disabled'));

        const childFormContainer = document.getElementById('childFormContainer');
        const parentFormContainer = document.getElementById('parentFormContainer');
        const childrenPermissionNotice = document.getElementById('childrenPermissionNotice');
        const parentsPermissionNotice = document.getElementById('parentsPermissionNotice');
        const cameraPermissionNotice = document.getElementById('cameraPermissionNotice');
        
        childFormContainer.style.display = 'block';
        parentFormContainer.style.display = 'block';
        childrenPermissionNotice.style.display = 'none';
        parentsPermissionNotice.style.display = 'none';
        cameraPermissionNotice.style.display = 'none';

        if (currentUser.role === 'teacher') {
            document.querySelector('[data-tab="users"]').classList.add('disabled');
            childrenPermissionNotice.textContent = `‚ö†Ô∏è B·∫°n ch·ªâ c√≥ quy·ªÅn xem v√† qu·∫£n l√Ω tr·∫ª trong ${currentUser.assignedClass}.`;
            childrenPermissionNotice.style.display = 'block';
        } else if (currentUser.role === 'parent') {
            ['children', 'parents', 'users'].forEach(tabName => {
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('disabled');
            });
            childFormContainer.style.display = 'none';
            parentFormContainer.style.display = 'none';
            cameraPermissionNotice.textContent = '‚ö†Ô∏è B·∫°n ch·ªâ c√≥ th·ªÉ xem camera c·ªßa l·ªõp con em m√¨nh ƒëang h·ªçc.';
            cameraPermissionNotice.style.display = 'block';
        }
    };

    const renderAll = () => {
        renderChildrenTable();
        renderParentsTable();
        updateDashboardStats();
        populateRelatedChildDropdown();
        renderCameras();
    };
    
    const showSuccessMessage = (elementId, message) => {
        const el = document.getElementById(elementId);
        el.textContent = message;
        el.style.display = 'block';
        setTimeout(() => {
            el.style.display = 'none';
        }, 3000);
    };

    const renderChildrenTable = () => {
        const tableBody = document.getElementById('childrenTableBody');
        tableBody.innerHTML = '';
        
        let childrenToShow = db.children;
        if(currentUser.role === 'teacher') {
            childrenToShow = db.children.filter(child => child.class === currentUser.assignedClass);
        } else if (currentUser.role === 'parent') {
            childrenToShow = db.children.filter(child => child.id === currentUser.childId);
        }

        if (childrenToShow.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding: 20px;">Kh√¥ng c√≥ d·ªØ li·ªáu.</td></tr>`;
            return;
        }

        childrenToShow.forEach(child => {
            const row = `
                <tr>
                    <td>${child.name}</td>
                    <td>${child.birthDate}</td>
                    <td>${child.gender}</td>
                    <td>${child.class}</td>
                    <td>${child.address}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteChild(${child.id})">X√≥a</button></td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    };

    const renderParentsTable = () => {
        const tableBody = document.getElementById('parentsTableBody');
        tableBody.innerHTML = '';
        
        let parentsToShow = db.parents;
        if(currentUser.role === 'teacher') {
            const classChildrenIds = db.children.filter(c => c.class === currentUser.assignedClass).map(c => c.id);
            parentsToShow = db.parents.filter(p => classChildrenIds.includes(p.childId));
        }

        if (parentsToShow.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding: 20px;">Kh√¥ng c√≥ d·ªØ li·ªáu.</td></tr>`;
            return;
        }

        parentsToShow.forEach(parent => {
            const child = db.children.find(c => c.id === parent.childId);
            const row = `
                <tr>
                    <td>${parent.fatherName || 'N/A'}</td>
                    <td>${parent.motherName || 'N/A'}</td>
                    <td>${parent.fatherPhone || 'N/A'}</td>
                    <td>${parent.motherPhone || 'N/A'}</td>
                    <td>${parent.email || 'N/A'}</td>
                    <td>${child ? child.name : 'N/A'}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteParent(${parent.id})">X√≥a</button></td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    };
    
    const renderCameras = () => {
        const cameraGrid = document.getElementById('cameraGrid');
        cameraGrid.innerHTML = '';
        
        let camerasToShow = db.cameras;
        if (currentUser.role === 'parent') {
            const childClass = db.children.find(c => c.id === currentUser.childId)?.class;
            if(childClass) {
                camerasToShow = db.cameras.filter(cam => cam.class === childClass || cam.class === 'Chung');
            } else {
                 camerasToShow = db.cameras.filter(cam => cam.class === 'Chung');
            }
        }
        
        camerasToShow.forEach(cam => {
            const feed = `
                <div class="camera-feed">
                    <img src="${cam.url}" alt="${cam.name}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/000000/FFFFFF?text=Error';">
                    <div class="camera-label">${cam.name}</div>
                </div>
            `;
            cameraGrid.innerHTML += feed;
        });
         document.getElementById('activeCameras').textContent = camerasToShow.length;
    };

    const updateDashboardStats = () => {
        document.getElementById('totalChildren').textContent = db.children.length;
        document.getElementById('totalParents').textContent = db.parents.length;
    };

    const populateRelatedChildDropdown = () => {
        const select = document.getElementById('relatedChild');
        select.innerHTML = '<option value="">Ch·ªçn tr·∫ª</option>';
        db.children.forEach(child => {
            const option = `<option value="${child.id}">${child.name}</option>`;
            select.innerHTML += option;
        });
    };

    const handleChildFormSubmit = (e) => {
        e.preventDefault();
        const newChild = {
            id: Date.now(),
            name: document.getElementById('childName').value,
            birthDate: document.getElementById('childBirthDate').value,
            gender: document.getElementById('childGender').value,
            class: document.getElementById('childClass').value,
            address: document.getElementById('childAddress').value,
            health: document.getElementById('childHealth').value
        };
        db.children.push(newChild);
        renderAll();
        e.target.reset();
        showSuccessMessage('childSuccessMessage', '‚úÖ Th√¥ng tin tr·∫ª ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng!');
    };

    const handleParentFormSubmit = (e) => {
        e.preventDefault();
        const newParent = {
            id: Date.now(),
            fatherName: document.getElementById('fatherName').value,
            motherName: document.getElementById('motherName').value,
            fatherPhone: document.getElementById('fatherPhone').value,
            motherPhone: document.getElementById('motherPhone').value,
            email: document.getElementById('parentEmail').value,
            childId: parseInt(document.getElementById('relatedChild').value)
        };
        db.parents.push(newParent);
        renderAll();
        e.target.reset();
        showSuccessMessage('parentSuccessMessage', '‚úÖ Th√¥ng tin ph·ª• huynh ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng!');
    };
    
    window.deleteChild = (id) => {
        if(currentUser.role === 'parent') return;
        if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a th√¥ng tin tr·∫ª n√†y?')) {
            db.children = db.children.filter(child => child.id !== id);
            db.parents = db.parents.filter(parent => parent.childId !== id);
            renderAll();
        }
    };
    
    window.deleteParent = (id) => {
        if(currentUser.role === 'parent') return;
        if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a th√¥ng tin ph·ª• huynh n√†y?')) {
            db.parents = db.parents.filter(parent => parent.id !== id);
            renderAll();
        }
    };

    window.showTab = (tabName) => {
        if (document.querySelector(`[data-tab="${tabName}"]`).classList.contains('disabled')) {
            return;
        }
        
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));

        document.getElementById(tabName).classList.add('active');
        document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
    };

    window.logout = () => {
        currentUser = null;
        mainApp.style.display = 'none';
        loginScreen.style.display = 'flex';
    };

    loginForm.addEventListener('submit', handleLogin);
    document.getElementById('childForm').addEventListener('submit', handleChildFormSubmit);
    document.getElementById('parentForm').addEventListener('submit', handleParentFormSubmit);

});
</script>
</body>
</html>
