<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="readnovel_page_title">Chọn Truyện - IVS STEAM</title>
    <meta name="description" content="Chọn và đọc các truyện song ngữ Anh-Việt LEGNAXE do IVS STEAM phát triển." data-lang-key="readnovel_meta_description">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#3b82f6',
                        'secondary': '#10b981',
                        'warning': '#f59e0b',
                        'neutral': {
                            50: '#f9fafb', 100: '#f3f4f6', 200: '#e5e7eb', 300: '#d1d5db', 500: '#6b7280', 700: '#374151',
                        },
                        'blue-600': '#2563eb', 'red-100': '#fee2e2', 'red-300': '#fca5a5', 'red-700': '#b91c1c', 'red-800': '#991b1b',
                        'gray-50': '#f9fafb', 'gray-200': '#e5e7eb', 'gray-500': '#6b7280', 'gray-700': '#374151',
                        'gray-800': '#1f2937', 'gray-900': '#111827', 'red-900': '#7f1d1d', 'red-200': '#fecaca',
                    }
                }
            },
            plugins: [],
        };
    </script>
    <link rel="stylesheet" href="css/styles.css"> 
    <style>
        /* Basic body and main content styling */
        body {
            font-family: 'Inter', sans-serif;
            padding-top: 60px; /* Default header height for mobile */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        @media (min-width: 1024px) {
            body {
                padding-top: 80px; /* Header height for desktop */
            }
        }
        main {
            flex-grow: 1;
        }

        /* Header/Footer Placeholder Styles */
        #header-placeholder, #footer-placeholder {
            min-height: 60px; /* Fallback min-height for mobile */
        }
        @media (min-width: 1024px) {
            #header-placeholder {
                min-height: 80px; /* Fallback min-height for desktop header */
            }
        }
        .fetch-error-message {
            text-align: center; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; color: #b91c1c; background-color: #fee2e2;
        }
        .fetch-error-message.header-error {
            position: fixed; top: 0; left: 0; right: 0; z-index: 40; min-height: 60px; display: flex; align-items: center; justify-content: center;
        }
        @media (min-width: 1024px) { .fetch-error-message.header-error { min-height: 80px; } }
        html.dark .fetch-error-message { background-color: rgba(127, 29, 29, 0.5); border-color: #b91c1c; color: #fecaca; }

        /* Search Bar Styles */
        .search-bar {
            margin-bottom: 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; overflow: hidden; background-color: white;
        }
        html.dark .search-bar { border-color: #4b5563; background-color: #374151; }
        .search-bar input { width: 100%; padding: 0.5rem 0.75rem; background-color: transparent; color: inherit; }
        .search-bar input:focus { outline: 2px solid transparent; outline-offset: 2px; }
        html.dark .search-bar input::placeholder { color: #9ca3af; }

        /* Novel List and Card Styles */
        .novel-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .novel-card {
            background-color: #ffffff; border-radius: 0.5rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            overflow: hidden; display: flex; flex-direction: column;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        html.dark .novel-card { background-color: #1f2937; box-shadow: 0 4px 6px -1px rgba(255, 255, 255, 0.05), 0 2px 4px -2px rgba(255, 255, 255, 0.05); }
        .novel-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); }
        html.dark .novel-card:hover { box-shadow: 0 10px 15px -3px rgba(255, 255, 255, 0.07), 0 4px 6px -4px rgba(255, 255, 255, 0.07); }
        .cover-link { display: block; }
        .book-cover { width: 100%; aspect-ratio: 2 / 3; object-fit: cover; background-color: #e5e7eb; }
        html.dark .book-cover { background-color: #374151; }
        .card-content { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; }
        .read-button {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 0.5rem 1rem; border-radius: 0.375rem; font-weight: 500; text-align: center;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            background-color: #3b82f6; color: #ffffff; border: 1px solid transparent;
        }
        .read-button:hover { background-color: #2563eb; }
        .english-button { background-color: #10b981; color: #ffffff; }
        .english-button:hover { background-color: #059669; }

        /* Floating Action Button (FAB) Container Styles */
        .fab-container {
            position: fixed;
            bottom: 1.5rem; 
            right: 1.5rem;  
            z-index: 50;    
            display: flex;
            flex-direction: column;
            align-items: flex-end; 
        }

        .fab-container > * { 
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;    
            height: 3rem;   
            border-radius: 9999px; 
            color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
            transition-property: background-color, transform, box-shadow;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
            text-decoration: none; 
        }
        .fab-container > *:hover {
            transform: scale(1.1); 
        }

        .fab-container > *:not(:last-child) {
            margin-bottom: 0.75rem; 
        }

        .fab-messenger { background-color: #006AFF; }
        .fab-messenger:hover { background-color: #0052CC; }
        
        .fab-phone { background-color: #10B981; }
        .fab-phone:hover { background-color: #059669; }
        
        .fab-zalo { background-color: #0068FF; }
        .fab-zalo:hover { background-color: #0058E6; }
        
        .fab-email { background-color: #4B5563; }
        .fab-email:hover { background-color: #374151; }
        
        #scroll-to-top-btn { 
            background-color: #374151;
        }
        #scroll-to-top-btn:hover {
            background-color: #1f2937;
        }
        #scroll-to-top-btn.hidden {
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px); /* Add a slight upward movement when hiding */
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
         #scroll-to-top-btn.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 text-neutral-700 dark:bg-gray-900 dark:text-neutral-300 font-sans antialiased">

    <header id="header-placeholder" class="fixed top-0 left-0 right-0 z-40">
        <div class="w-full h-[60px] lg:h-[80px] bg-gray-200 dark:bg-gray-700 animate-pulse flex items-center justify-center text-gray-500 dark:text-gray-400">
            Đang tải menu...
        </div>
        <div class="fetch-error-fallback hidden">
            <div class="fetch-error-message header-error">
                Lỗi tải menu. Vui lòng thử lại sau.
                <a href="/" class="ml-4 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">Về Trang Chủ</a>
            </div>
        </div>
    </header>

    <main class="w-full">
        <div class="main-content-wrapper py-8">
            <div class="page-content-container max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h1 class="page-title text-3xl font-bold mb-6 text-gray-900 dark:text-white" data-lang-key="readnovel_title">Chọn Truyện Để Đọc</h1>

                <div class="search-bar mb-6">
                    <input type="text" id="searchInput" placeholder="Tìm kiếm truyện theo tên hoặc mô tả..." data-lang-key="readnovel_search_placeholder" class="w-full p-2 bg-transparent focus:outline-none placeholder-gray-500 dark:placeholder-gray-400">
                </div>

                <div class="settings flex justify-end mb-4">
                    <button id="darkModeToggleButtonPage" aria-label="Chuyển chế độ Sáng/Tối" title="Chuyển chế độ Sáng/Tối" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-adjust text-xl"></i>
                    </button>
                </div>

                <div class="novel-list">
                    <div class="novel-card group">
                        <a href="read-legnaxe_part1_vi.html" class="cover-link" aria-label="Đọc LEGNAXE Phần 1 Tiếng Việt">
                            <picture>
                                <source srcset="images/pages/novels/legnaxe1vertical.png" type="image/webp">
                                <img src="images/pages/novels/legnaxe1vertical.png" alt="Bìa truyện LEGNAXE Phần 1" class="book-cover" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/400x600/EBF4FF/4A5568?text=LEGNAXE+P1'; this.alt='Lỗi tải ảnh bìa LEGNAXE Phần 1';">
                            </picture>
                        </a>
                        <div class="card-content">
                            <h3 class="text-lg font-semibold !line-clamp-1 mb-1 text-gray-900 dark:text-white" data-lang-key="readnovel_legnaxe1_title">LEGNAXE: Phần 1</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-4" data-lang-key="readnovel_legnaxe1_desc">Bí mật cuộc đại chiến Thiên Đàng / <strong>Secrets of Heaven's Great War.</strong></p>
                            <div class="flex flex-col sm:flex-row gap-3 mt-auto">
                                <a href="read-legnaxe_part1_vi.html" class="read-button" data-lang-key="readnovel_read_vi">
                                    <i class="fas fa-book-open mr-2"></i> Đọc (TV)
                                </a>
                                <a href="read-legnaxe_part1_en.html" class="read-button english-button" data-lang-key="readnovel_read_en">
                                    <i class="fas fa-book-open mr-2"></i> Read (EN)
                                </a>
                            </div>
                        </div>
                        <div class="story-item">
                            <h2>LEGNAXE: The Secret of Great Heaven War - Phần 1</h2>

                            <div class="summary-container">
                                <p class="summary-short">
                                    Câu chuyện bắt đầu tại Thiên Đàng, nơi Lucifer, một Tổng lãnh Thiên thần, cảm thấy bất mãn với sự hoàn hảo đơn điệu và đặt nghi vấn về ý nghĩa tồn tại. Sự bất mãn leo thang khi Đấng Sáng Tạo quyết định tạo ra Nhân Loại trên Trái Đất và yêu cầu các thiên thần phục tùng họ...
                                </p>
                                <div class="summary-full" style="display: none;">
                                    <p>Câu chuyện bắt đầu tại Thiên Đàng, nơi Lucifer, một Tổng lãnh Thiên thần, cảm thấy bất mãn với sự hoàn hảo đơn điệu và đặt nghi vấn về ý nghĩa tồn tại. Sự bất mãn leo thang khi Đấng Sáng Tạo quyết định tạo ra Nhân Loại trên Trái Đất và yêu cầu các thiên thần phục tùng họ. Lucifer kịch liệt phản đối, dẫn đến sự chia rẽ trong hàng ngũ thiên thần.</p>

                                    <p>Trên Trái Đất, Adam và Lilith được tạo ra. Lilith, không chấp nhận vai trò phụ thuộc vào Adam, nhận được tri thức từ Lucifer và rời khỏi Eden. Sau đó, Đấng Sáng Tạo tạo ra Eve từ xương sườn của Adam. Lucifer, dưới hình dạng rắn, cám dỗ Eve ăn trái cấm từ Cây Tri Thức, khiến cả Adam và Eve bị trục xuất khỏi Eden.</p>

                                    <p>Tại Thiên Đàng, Lucifer tập hợp các thiên thần nổi loạn, phát động cuộc chiến chống lại Đấng Sáng Tạo. Cuộc chiến này gây ra sự rạn nứt Tấm Màn ngăn cách các cõi, đe dọa giải phóng bóng tối. Healiangel hy sinh để ổn định Tấm Màn, nhưng cuộc chiến vẫn tiếp diễn. Cuối cùng, Lucifer và một phần ba thiên binh bị trục xuất xuống Địa Ngục.</p>

                                    <p>Trên Trần Gian, sự ra đời của Jesus ở Bê-lem mang đến hy vọng. Michael, Gabriel và Healiangel bảo vệ đứa trẻ khỏi Lucifer. Tuy nhiên, Đấng Sáng Tạo rút lui, trao quyền tự quyết cho tạo vật, gây mất cân bằng. Thiên Đàng tan rã, cuốn Healiangel và nhiều thiên thần khác vào một cơn bão năng lượng, khiến họ mất đi ký ức và rơi xuống Trái Đất, bắt đầu cuộc sống như con người. Trong khi đó, Thiên Đàng và Địa Ngục chuẩn bị cho những diễn biến tiếp theo của cuộc chiến vĩnh cửu.</p>

                                    <p><strong>Chú thích:</strong> Bản tóm tắt này cô đọng các sự kiện chính và mạch truyện. Phần đầy đủ của tác phẩm sẽ bao gồm trọn vẹn mọi diễn biến chi tiết, suy nghĩ nội tâm của nhân vật, các tình tiết phụ và yếu tố khác làm nên chiều sâu của câu chuyện.</p>
                                </div>
                                <a href="#" class="read-more-link">Đọc thêm</a>
                            </div>
                        </div>

                    </div>

                    <div class="novel-card group">
                        <a href="read-legnaxe_part2_vi.html" class="cover-link" aria-label="Đọc LEGNAXE Phần 2 Tiếng Việt">
                            <picture>
                                <source srcset="images/pages/novels/legnaxe2vertical.png" type="image/webp">
                                <img src="images/pages/novels/legnaxe2vertical.png" alt="Bìa truyện LEGNAXE Phần 2" class="book-cover" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/400x600/FFF5F5/7F1D1D?text=LEGNAXE+P2'; this.alt='Lỗi tải ảnh bìa LEGNAXE Phần 2';">
                            </picture>
                        </a>
                        <div class="card-content">
                            <h3 class="text-lg font-semibold !line-clamp-1 mb-1 text-gray-900 dark:text-white" data-lang-key="readnovel_legnaxe2_title">LEGNAXE: Phần 2</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2 mb-4" data-lang-key="readnovel_legnaxe2_desc">Hành trình Trần Gian & Trái tim con người / <strong>Heavenly, Human’s Heart.</strong></p>
                            <div class="flex flex-col sm:flex-row gap-3 mt-auto">
                                <a href="read-legnaxe_part2_vi.html" class="read-button" data-lang-key="readnovel_read_vi">
                                    <i class="fas fa-book-open mr-2"></i> Đọc (TV)
                                </a>
                                <a href="read-legnaxe_part2_en.html" class="read-button english-button" data-lang-key="readnovel_read_en">
                                    <i class="fas fa-book-open mr-2"></i> Read (EN)
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="story-item">
                        <h2>LEGNAXE: Heavenly, Human's Heart - Phần 2</h2>

                        <div class="summary-container">
                            <p class="summary-short">
                                Hành trình khám phá Trần Gian và trái tim con người, nơi các thiên thần và con người đối mặt với những thử thách về niềm tin, tình yêu và sự hy sinh...
                            </p>
                            <div class="summary-full" style="display: none;">
                                <p>Hành trình khám phá Trần Gian và trái tim con người, nơi các thiên thần và con người đối mặt với những thử thách về niềm tin, tình yêu và sự hy sinh. Câu chuyện tiếp tục với sự xuất hiện của những nhân vật mới, những mối quan hệ phức tạp và những bí mật được hé lộ.</p>

                                <p>Trên Trần Gian, các thiên thần rơi xuống phải học cách sống như con người, đối mặt với những cảm xúc và thử thách mà họ chưa từng trải qua. Trong khi đó, Lucifer âm thầm xây dựng lực lượng, chuẩn bị cho một cuộc chiến mới nhằm giành quyền kiểm soát cả Thiên Đàng và Địa Ngục.</p>

                                <p>Những nhân vật chính phải đối mặt với những lựa chọn khó khăn, khi tình yêu và lòng trung thành bị thử thách. Họ phải tìm ra ý nghĩa thực sự của sự tồn tại và vai trò của mình trong cuộc chiến vĩnh cửu giữa ánh sáng và bóng tối.</p>

                                <p>Cuộc hành trình này không chỉ là về sự sống còn, mà còn là về việc khám phá bản chất con người, sự tha thứ và hy vọng. Những sự kiện trong phần này sẽ định hình tương lai của cả Thiên Đàng, Địa Ngục và Trần Gian.</p>

                                <p><strong>Chú thích:</strong> Bản tóm tắt này cô đọng các sự kiện chính và mạch truyện. Phần đầy đủ của tác phẩm sẽ bao gồm trọn vẹn mọi diễn biến chi tiết, suy nghĩ nội tâm của nhân vật, các tình tiết phụ và yếu tố khác làm nên chiều sâu của câu chuyện.</p>
                            </div>
                            <a href="#" class="read-more-link">Đọc thêm</a>
                        </div>
                    </div>               
                    
                    </div>
            </div>
        </div>
    </main>

    <footer id="footer-placeholder">
        <div class="w-full min-h-[60px] bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-gray-500 dark:text-gray-400 animate-pulse">
            Đang tải footer...
        </div>
        <div class="fetch-error-fallback hidden">
            <div class="bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-center p-4">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="mb-4">
                        <a href="/" class="text-lg font-semibold text-gray-700 dark:text-gray-300">IVS STEAM (Lỗi tải)</a>
                    </div>
                    <div class="flex justify-center space-x-4 mb-4">
                        <a href="index.html" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Trang Chủ</a>
                        <a href="steambyivs.html" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">STEAM</a>
                        <a href="readnovel.html" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Chọn Truyện</a>
                        <a href="contact.html" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">Liên Hệ</a>
                    </div>
                    <div class="text-sm">
                        <p>© <span id="current-year-fallback">2024</span> IVS STEAM. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <div class="fab-container">
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://ivs.id.vn/readnovel.html" target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook" class="fab-messenger" title="Share on Facebook">
            <i class="fab fa-facebook-f text-xl"></i>
        </a>
        <a href="https://twitter.com/intent/tweet?url=https://ivs.id.vn/readnovel.html&text=Check%20out%20these%20novels%20from%20IVS%20STEAM!" target="_blank" rel="noopener noreferrer" aria-label="Share on Twitter" class="bg-sky-500 hover:bg-sky-600" title="Share on Twitter (X)">
            <i class="fab fa-twitter text-xl"></i>
        </a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://ivs.id.vn/readnovel.html&title=Novels%20from%20IVS%20STEAM" target="_blank" rel="noopener noreferrer" aria-label="Share on LinkedIn" class="bg-blue-700 hover:bg-blue-800" title="Share on LinkedIn">
            <i class="fab fa-linkedin-in text-xl"></i>
        </a>
        <a href="mailto:?subject=Novels%20from%20IVS%20STEAM&body=Check%20out%20this%20page%3A%20https%3A%2F%2Fivs.id.vn%2Freadnovel.html" target="_blank" rel="noopener noreferrer" aria-label="Share via Email" class="fab-email" title="Share via Email">
            <i class="fas fa-envelope text-xl"></i>
        </a>
        <button id="scroll-to-top-btn" title="Cuộn lên đầu trang" class="hidden">
            <i class="fas fa-arrow-up text-xl"></i>
        </button>
    </div>
    
    <script src="js/language.js" defer></script>
    <script>
        // --- Dark Mode Logic ---
        const htmlElement = document.documentElement;
        const darkModeToggleButtonPage = document.getElementById('darkModeToggleButtonPage'); 

        function applyInitialDarkMode() {
            const darkModePreference = localStorage.getItem('darkMode');
            if (darkModePreference === 'enabled' || 
               (!darkModePreference && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                htmlElement.classList.add('dark');
            } else {
                htmlElement.classList.remove('dark');
            }
        }

        function toggleDarkMode() {
            const isDarkMode = htmlElement.classList.toggle('dark');
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
        }

        if (darkModeToggleButtonPage) {
            darkModeToggleButtonPage.addEventListener('click', toggleDarkMode);
        }
        
        applyInitialDarkMode(); 

        // --- Search Functionality ---
        const searchInput = document.getElementById('searchInput');
        const novelCards = document.querySelectorAll('.novel-card');

        searchInput?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            novelCards.forEach(card => {
                const titleElement = card.querySelector('h3');
                const descElement = card.querySelector('p');
                const title = titleElement ? titleElement.textContent.toLowerCase() : '';
                const desc = descElement ? descElement.textContent.toLowerCase() : '';
                const isVisible = title.includes(searchTerm) || desc.includes(searchTerm);
                card.style.display = isVisible ? '' : 'none';
            });
        });

        // --- Scroll to Top Button ---
        const scrollToTopButton = document.getElementById('scroll-to-top-btn');

        if (scrollToTopButton) {
            scrollToTopButton.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            window.addEventListener('scroll', function() {
                if (window.scrollY > 300) {
                    scrollToTopButton.classList.remove('hidden');
                    scrollToTopButton.classList.add('visible');
                } else {
                    scrollToTopButton.classList.remove('visible');
                    // Add hidden class after transition for smoother disappearance
                    setTimeout(() => {
                         if (window.scrollY <=300) scrollToTopButton.classList.add('hidden');
                    }, 300); 
                }
            });
        }
        
        // --- Fetch Header and Footer ---
        document.addEventListener('DOMContentLoaded', function() {
            const headerPlaceholder = document.getElementById('header-placeholder');
            const footerPlaceholder = document.getElementById('footer-placeholder');
            const headerPath = 'header.html'; 
            const footerPath = 'footer.html'; 

            function handleFetchError(error, placeholderElement, type, filePath) {
                console.error(`Error fetching ${type} from ${filePath}:`, error);
                const fallbackElement = placeholderElement.querySelector('.fetch-error-fallback');
                const pulseElement = placeholderElement.querySelector('.animate-pulse');

                if (pulseElement) pulseElement.style.display = 'none';
                if (fallbackElement) {
                    fallbackElement.classList.remove('hidden');
                    if(type === 'header') {
                        const errorMsgDiv = fallbackElement.querySelector('.fetch-error-message');
                        if (errorMsgDiv) errorMsgDiv.classList.add('header-error');
                    }
                } else {
                    placeholderElement.innerHTML = `<div class="fetch-error-message ${type}-error">Lỗi khi tải ${type}. Vui lòng tải lại trang.</div>`;
                    if (type === 'header') {
                        const errorMsgDiv = placeholderElement.querySelector('.fetch-error-message');
                        if (errorMsgDiv) errorMsgDiv.classList.add('header-error');
                    }
                }
                if(type === 'header') setActiveNavLink('readnovel.html'); 
                if(type === 'footer' && document.getElementById('current-year-fallback')) {
                    document.getElementById('current-year-fallback').textContent = new Date().getFullYear();
                }
            }

            function fetchComponent(placeholder, path, type) {
                if (!placeholder) {
                    console.error(`${type} placeholder element not found.`);
                    return Promise.reject(`${type} placeholder not found`);
                }
                return fetch(path)
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                        return response.text();
                    })
                    .then(data => {
                        placeholder.innerHTML = data;
                        if (type === 'header') {
                            setActiveNavLink('readnovel.html');
                            applyInitialDarkMode(); 
                                                        
                            const headerDarkModeButton = document.getElementById('darkModeToggleButtonHeader'); // ID for header's dark mode button
                            if (headerDarkModeButton) {
                                headerDarkModeButton.addEventListener('click', toggleDarkMode);
                            }

                            if (typeof window.applyTranslations === 'function') {
                                window.applyTranslations(); 
                            }
                             if (typeof window.attachLanguageSwitcherEvents === 'function') {
                                window.attachLanguageSwitcherEvents(); 
                            }
                            // Example: if (typeof window.initHeaderScripts === 'function') window.initHeaderScripts();
                        }
                        if (type === 'footer' && document.getElementById('current-year')) {
                             document.getElementById('current-year').textContent = new Date().getFullYear();
                        }
                        if (typeof window.applyTranslations === 'function') {
                            window.applyTranslations();
                        }
                    })
                    .catch(error => handleFetchError(error, placeholder, type, path));
            }

            fetchComponent(headerPlaceholder, headerPath, 'header');
            fetchComponent(footerPlaceholder, footerPath, 'footer');
            
            if (typeof window.applyTranslations === 'function') {
                setTimeout(() => { window.applyTranslations(); }, 100);
            }
        });

        function setActiveNavLink(currentPageName) {
            const navLinks = document.querySelectorAll('#header-placeholder a.nav-link, #header-placeholder .submenu a, #header-placeholder .mobile-submenu a, #header-placeholder .fetch-error-fallback a');
            if (navLinks.length === 0) {
                // console.warn("setActiveNavLink: No navigation links found.");
                return;
            }

            navLinks.forEach(link => {
                link.classList.remove('active-menu-item', 'active-parent-item', 'text-primary', 'dark:text-blue-400', 'bg-orange-500', 'dark:bg-orange-400', 'text-white');
                link.removeAttribute('aria-current');

                let linkHref = link.getAttribute('href');
                if (linkHref) {
                    // Normalize by removing leading/trailing slashes and .html
                    let normalizedLinkHref = linkHref.replace(/^\/+|\/+$/g, '').replace(/\.html$/, '');
                    if (normalizedLinkHref === "" || normalizedLinkHref === "index") normalizedLinkHref = "index"; // Treat empty or "index" as "index"

                    let normalizedCurrentPageName = currentPageName.replace(/^\/+|\/+$/g, '').replace(/\.html$/, '');
                     if (normalizedCurrentPageName === "") normalizedCurrentPageName = "index"; // Treat empty current page as "index"


                    if (normalizedLinkHref === normalizedCurrentPageName) {
                        link.classList.add('active-menu-item'); 
                        // Example active style (you might need to adjust based on your header's CSS)
                        link.classList.add('bg-orange-600', 'text-white'); 
                        link.setAttribute('aria-current', 'page');

                        let parent = link.closest('.main-menu-item, .mobile-menu-item');
                        while(parent){
                            const parentButton = parent.querySelector(':scope > button.nav-link, :scope > button.mobile-submenu-toggle');
                            if(parentButton) {
                                parentButton.classList.add('active-parent-item');
                                // Example parent active style
                                parentButton.classList.add('bg-orange-600', 'text-white');
                            }
                            parent = parent.parentElement.closest('.main-menu-item, .mobile-menu-item');
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>