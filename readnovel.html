<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chọn Truyện Để Đọc - IVS</title> <meta name="description" content="Danh sách truyện hấp dẫn từ IVS: LEGNAXE - Bí mật cuộc chiến Thiên Đàng.">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {}, // Bạn có thể mở rộng màu sắc ở đây nếu cần
                }
            },
            darkMode: 'class' // Bật chế độ dark mode dựa trên class 'dark' trên thẻ html
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --header-height-initial: 80px; /* Chiều cao header ban đầu (desktop) */
            --header-height-scrolled: 60px; /* Chiều cao header khi cuộn (desktop) */
            --header-height-mobile: 60px; /* Chiều cao header (mobile) */
        }

        body {
            padding-top: var(--header-height-mobile); /* Đẩy nội dung xuống dưới header mobile */
            font-family: 'Inter', sans-serif; /* Font chữ chính */
            transition: background-color 0.3s, color 0.3s; /* Hiệu ứng chuyển màu nền */
            @apply bg-gray-100 text-gray-800 flex flex-col min-h-screen; /* Layout cơ bản */
        }

        /* Đẩy nội dung xuống dưới header desktop */
        @media (min-width: 1024px) {
            body { padding-top: var(--header-height-initial); }
        }

        /* Dark Mode Styles */
        html.dark body { @apply bg-gray-900 text-gray-300; }
        html.dark .page-content-container { @apply bg-gray-800; }
        html.dark h1.page-title { @apply text-sky-400; }
        html.dark .novel-card { @apply bg-gray-700 border-gray-600; }
        html.dark .novel-card h3 { @apply text-gray-100; }
        html.dark .novel-card p { @apply text-gray-300; }
        html.dark .novel-card a.read-button:not([aria-disabled='true']) {
            @apply bg-gradient-to-r from-sky-600 to-blue-600 hover:from-sky-700 hover:to-blue-700;
        }
        /* Nút tiếng Anh trong dark mode */
        html.dark .novel-card a.read-button.english-button:not([aria-disabled='true']) {
             @apply !bg-gradient-to-r !from-emerald-600 !to-green-600 !hover:from-emerald-700 !to-green-700;
        }
        html.dark .settings button {
            @apply bg-gradient-to-r from-pink-600 to-red-600 hover:from-pink-700 hover:to-red-700;
        }
        /* Nút bị vô hiệu hóa trong dark mode */
        html.dark .novel-card a.read-button[aria-disabled='true'] {
             @apply !bg-gradient-to-r !from-gray-600 !to-gray-700 !text-gray-400;
        }

        /* Header Styles (Sẽ được tải từ _header.html) */
        /* Giữ lại một vài style cơ bản để tránh CLS (Cumulative Layout Shift) */
        #header-placeholder {
            min-height: var(--header-height-mobile); /* Chiều cao tối thiểu ban đầu */
        }
        @media (min-width: 1024px) {
             #header-placeholder { min-height: var(--header-height-initial); }
        }

        /* Novel List Styles */
        .page-content-container {
            @apply mt-6 mb-8 p-4 sm:p-6 lg:p-8 bg-white rounded-xl shadow-lg; /* Container nội dung chính */
        }

        h1.page-title {
            @apply text-center text-3xl sm:text-4xl font-bold text-gray-800 mt-4 mb-8 tracking-tight; /* Tiêu đề trang */
        }

        .novel-list {
            @apply grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 sm:gap-8; /* Lưới hiển thị truyện */
        }

        .novel-card {
            @apply bg-white rounded-lg overflow-hidden shadow-md border border-gray-200 flex flex-col transition-all duration-300 hover:shadow-xl hover:-translate-y-1; /* Thẻ truyện */
        }

        .novel-card .cover-link {
            @apply block overflow-hidden relative aspect-[2/3]; /* Link chứa ảnh bìa, giữ tỉ lệ 2:3 */
        }

        .novel-card img.book-cover {
            @apply w-full h-full object-cover transition-transform duration-300 group-hover:scale-105; /* Ảnh bìa */
        }

        .novel-card .card-content {
            @apply p-4 sm:p-5 flex flex-col flex-grow bg-gray-50 dark:bg-gray-700; /* Nội dung text của thẻ */
        }

        .novel-card h3 {
            @apply text-lg sm:text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2 leading-tight line-clamp-2 tracking-tight; /* Tiêu đề truyện */
        }

        .novel-card p {
            @apply text-sm text-gray-600 dark:text-gray-300 mb-4 flex-grow line-clamp-3 leading-relaxed; /* Mô tả truyện */
        }

        .novel-card a.read-button {
            @apply block w-full text-center py-3 px-4 bg-gradient-to-r from-blue-600 to-sky-600 text-white rounded-lg text-sm sm:text-base font-semibold shadow-md hover:from-blue-700 hover:to-sky-700 hover:shadow-lg min-h-[48px] transition-all duration-300 touch-action-manipulation mt-auto flex items-center justify-center gap-2; /* Nút đọc */
        }
        /* Nút đọc tiếng Anh */
        .novel-card a.read-button.english-button {
             @apply !bg-gradient-to-r !from-emerald-500 !to-green-500 !hover:from-emerald-600 !to-green-600;
        }

        /* Nút đọc bị vô hiệu hóa */
        .novel-card a.read-button[aria-disabled='true'] {
            @apply !bg-gradient-to-r !from-gray-400 !to-gray-500 !text-gray-200 !cursor-not-allowed !hover:from-gray-400 !hover:to-gray-500 !shadow-none;
        }

        /* Dark Mode Toggle Button */
        .settings {
            @apply fixed bottom-4 right-4 z-50;
        }

        .settings button {
            @apply py-2 px-5 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-full text-sm font-medium shadow hover:shadow-md transition-all duration-300 touch-action-manipulation;
        }

        /* Footer Styles (Sẽ được tải từ _footer.html) */
        #footer-placeholder {
             /* Có thể thêm min-height nếu cần */
        }

    </style>
</head>
<body class="antialiased"> <header id="header-placeholder">
        <div class="fixed top-0 left-0 right-0 z-50 flex items-center justify-center bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 animate-pulse" style="height: var(--header-height-mobile);">
             Đang tải header...
        </div>
    </header>

    <div class="main-content-wrapper flex-grow">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="page-content-container">
                <h1 class="page-title">Chọn Truyện Để Đọc</h1>

                <div class="settings">
                    <button onclick="toggleDarkMode()" aria-label="Chuyển chế độ Sáng/Tối">
                        <i class="fas fa-adjust mr-1"></i> <span class="hidden sm:inline">Sáng/Tối</span> </button>
                </div>

                <div class="novel-list">

                    <div class="novel-card group">
                        <a href="legnaxe_part1_vi.html" class="cover-link" aria-label="Đọc LEGNAXE Phần 1 Tiếng Việt">
                            <picture>
                                <source srcset="images/pages/novels/legnaxe1.webp" type="image/webp">
                                <img src="images/pages/novels/legnaxe1.png" alt="[Image of Bìa LEGNAXE Phần 1]" class="book-cover" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/400x600/EBF4FF/4A5568?text=LEGNAXE+P1';">
                            </picture>
                        </a>
                        <div class="card-content">
                            <h3 class="!line-clamp-1">LEGNAXE: Phần 1</h3>
                            <p class="mb-4">Bí mật cuộc đại chiến Thiên Đàng / Secrets of Heaven's Great War.</p>
                            <div class="flex flex-col sm:flex-row gap-3 mt-auto">
                                <a href="legnaxe_part1_vi.html" class="read-button">
                                    <i class="fas fa-book-open"></i> Đọc (TV)
                                </a>
                                <a href="legnaxe_part1_en.html" class="read-button english-button">
                                    <i class="fas fa-book-open"></i> Read (EN)
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="novel-card group">
                         <a href="legnaxe_part2_vi.html" class="cover-link" aria-label="Đọc LEGNAXE Phần 2 Tiếng Việt">
                             <picture>
                                 <source srcset="images/pages/novels/legnaxe2.webp" type="image/webp">
                                 <img src="images/pages/novels/legnaxe2.png" alt="" class="book-cover" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/400x600/FFF5F5/7F1D1D?text=LEGNAXE+P2';">
                             </picture>
                         </a>
                         <div class="card-content">
                             <h3 class="!line-clamp-1">LEGNAXE: Phần 2</h3>
                             <p class="mb-4">Hành trình Trần Gian & Trái tim con người / Heavenly, Human’s Heart.</p>
                             <div class="flex flex-col sm:flex-row gap-3 mt-auto">
                                 <a href="legnaxe_part2_vi.html" class="read-button">
                                     <i class="fas fa-book-open"></i> Đọc (TV)
                                 </a>
                                 <a href="#" class="read-button" aria-disabled="true" >
                                     <i class="fas fa-clock mr-1"></i> Read (EN - Soon) </a>
                             </div>
                         </div>
                    </div>

                    <div class="novel-card group opacity-50"> <a href="#" class="cover-link cursor-default" aria-label="Truyện sắp ra mắt">
                             <picture>
                                 <source srcset="https://placehold.co/400x600/F3E8FF/6B46C1?text=Coming+Soon.webp" type="image/webp">
                                 <img src="https://placehold.co/400x600/F3E8FF/6B46C1?text=Coming+Soon" alt="[Image of Bìa truyện sắp ra mắt]" class="book-cover" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/400x600/eee/aaa?text=Image+Error';">
                             </picture>
                         </a>
                         <div class="card-content">
                             <h3 class="!line-clamp-1">Truyện Mới</h3>
                             <p class="mb-4">Một cuộc phiêu lưu kỳ thú khác sắp bắt đầu...</p>
                             <div class="flex flex-col sm:flex-row gap-3 mt-auto">
                                 <a href="#" class="read-button" aria-disabled="true">
                                     <i class="fas fa-clock"></i> Sắp ra mắt
                                 </a>
                                  <a href="#" class="read-button english-button" aria-disabled="true">
                                     <i class="fas fa-clock"></i> Coming Soon
                                 </a>
                             </div>
                         </div>
                     </div>

                </div> </div> </div> </div> <footer id="footer-placeholder">
        <div class="bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-center p-4 animate-pulse">
            Đang tải footer...
        </div>
    </footer>

    <script>
        // --- Dark Mode Logic ---
        function toggleDarkMode() {
            const isDarkMode = document.documentElement.classList.toggle("dark");
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
            console.log(`Dark mode ${isDarkMode ? 'enabled' : 'disabled'}`);
        }

        // Apply dark mode on initial load based on localStorage or system preference
        if (localStorage.getItem('darkMode') === 'enabled' || (!localStorage.getItem('darkMode') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add("dark");
            console.log("Dark mode applied on load.");
        } else {
             document.documentElement.classList.remove("dark");
             console.log("Light mode applied on load.");
        }

        // --- Fetch Header and Footer Logic ---
        document.addEventListener('DOMContentLoaded', function() {
            const headerPlaceholder = document.getElementById('header-placeholder');
            const footerPlaceholder = document.getElementById('footer-placeholder');
            const headerPath = '_header.html'; // Đặt tên file header của bạn ở đây
            const footerPath = '_footer.html'; // Đặt tên file footer của bạn ở đây

            // --- Fetch Header ---
            if (headerPlaceholder) {
                console.log(`Fetching header from: ${headerPath}`);
                fetch(headerPath)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error fetching header! Status: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(data => {
                        headerPlaceholder.innerHTML = data;
                        console.log("Header content loaded.");
                        // Quan trọng: Gọi hàm khởi tạo script cho header (nếu có)
                        initializeHeaderScriptsIfNeeded();
                    })
                    .catch(error => {
                        console.error('Error fetching or processing header:', error);
                        // Hiển thị lỗi thân thiện hơn trên trang
                        headerPlaceholder.innerHTML = '<div class="fixed top-0 left-0 right-0 z-50 flex items-center justify-center bg-red-100 text-red-700" style="height: var(--header-height-mobile);"><i class="fas fa-exclamation-triangle mr-2"></i> Lỗi tải header. Vui lòng kiểm tra Console (F12).</div>';
                    });
            } else {
                console.warn("Header placeholder element (#header-placeholder) not found.");
            }

            // --- Fetch Footer ---
            if (footerPlaceholder) {
                 console.log(`Fetching footer from: ${footerPath}`);
                fetch(footerPath)
                    .then(response => {
                        if (!response.ok) {
                             throw new Error(`HTTP error fetching footer! Status: ${response.status}`);
                         }
                        return response.text();
                     })
                    .then(data => {
                        footerPlaceholder.innerHTML = data;
                        console.log("Footer content loaded.");
                         // Quan trọng: Gọi hàm khởi tạo script cho footer (nếu có)
                        initializeFooterScriptsIfNeeded();
                     })
                    .catch(error => {
                         console.error('Error fetching or processing footer:', error);
                         // Hiển thị lỗi thân thiện hơn trên trang
                         footerPlaceholder.innerHTML = '<div class="bg-red-100 text-red-700 text-center p-4"><i class="fas fa-exclamation-triangle mr-2"></i> Lỗi tải footer. Vui lòng kiểm tra Console (F12).</div>';
                     });
            } else {
                 console.warn("Footer placeholder element (#footer-placeholder) not found.");
             }

        });

        // --- Placeholder Functions for Script Initialization ---
        // Bạn cần định nghĩa nội dung các hàm này nếu header/footer có JS cần chạy lại
        function initializeHeaderScriptsIfNeeded() {
            console.log("Running initializeHeaderScriptsIfNeeded...");
            // Ví dụ: Tìm và gắn lại event listener cho nút mobile menu, dropdown ngôn ngữ...
            // Nếu bạn dùng file JS riêng cho header, hãy gọi hàm init của nó ở đây.
            // Ví dụ: if (typeof initHeader === 'function') { initHeader(); }

             // Tạm thời thêm log để kiểm tra
             const mobileMenuButton = document.getElementById('mobile-menu-button');
             if (mobileMenuButton) {
                 console.log("Mobile menu button found in fetched header.");
                 // Gắn lại event listener nếu cần
             } else {
                  console.warn("Mobile menu button not found after header fetch.");
             }
        }

        function initializeFooterScriptsIfNeeded() {
            console.log("Running initializeFooterScriptsIfNeeded...");
            // Ví dụ: Cập nhật năm copyright
             try {
                const currentYearSpan = document.querySelector('#footer-placeholder #current-year'); // Tìm trong footer vừa tải
                if (currentYearSpan) {
                    currentYearSpan.textContent = new Date().getFullYear();
                    console.log("Copyright year updated.");
                } else {
                    console.warn("Current year span (#current-year) not found in fetched footer.");
                }
             } catch (e) {
                  console.error("Error initializing footer scripts:", e);
             }
        }

    </script>

</body>
</html>
```

**Giải thích và Lưu ý:**

1.  **Cấu trúc HTML:** File này là một trang HTML hoàn chỉnh, bạn có thể lưu nó với tên ví dụ như `chon-truyen.html`.
2.  **CSS:** Bao gồm cả Tailwind CDN, cấu hình Tailwind cơ bản, Google Fonts và các CSS tùy chỉnh cho giao diện trang chọn truyện, bao gồm cả dark mode.
3.  **Placeholders:** Các thẻ `<header id="header-placeholder">` và `<footer id="footer-placeholder">` được đặt ở vị trí mong muốn. Có thêm nội dung tạm thời ("Đang tải...") để người dùng biết điều gì đang xảy ra.
4.  **JavaScript Fetch:** Mã JavaScript ở cuối cùng sẽ thực hiện:
    * Áp dụng dark mode khi tải trang.
    * Chờ DOM tải xong (`DOMContentLoaded`).
    * Tìm các placeholder.
    * Dùng `fetch` để lấy nội dung từ `_header.html` và `_footer.html`.
    * **Xử lý lỗi:** Có thêm `catch` để bắt lỗi nếu không tìm thấy file hoặc có vấn đề khi fetch, và hiển thị thông báo lỗi trên trang cũng như trong Console (F12).
    * Chèn nội dung vào placeholder.
    * **Gọi hàm khởi tạo:** Gọi `initializeHeaderScriptsIfNeeded()` và `initializeFooterScriptsIfNeeded()`. **Đây là phần quan trọng** nếu header/footer của bạn có JavaScript riêng cần chạy lại (ví dụ: menu dropdown, nút chuyển ngôn ngữ). Bạn cần thêm code vào các hàm này để khởi tạo lại JS đó. Hiện tại, chúng chỉ log ra console và cập nhật năm copyright trong footer làm ví dụ.
5.  **Giao diện danh sách truyện:** Phần `<div class="novel-list">` đã được cập nhật để nhóm các phiên bản ngôn ngữ vào cùng một thẻ card, sử dụng flexbox cho các nút đọc.
6.  **Ảnh:** Sử dụng thẻ `<picture>` để có thể cung cấp định dạng ảnh tối ưu (như `.webp`) và fallback về `.png` hoặc `.jpg`. Có thêm `onerror` để hiển thị ảnh placeholder nếu ảnh gốc bị lỗi.
7.  **Accessibility:** Thêm `aria-label` cho các link và nút để cải thiện khả năng tiếp cận.

Hãy đảm bảo bạn đã tạo các file `_header.html` và `_footer.html` và đặt chúng cùng cấp với file HTML này. Sau đó, mở file HTML này trong trình duyệt để xem kết q